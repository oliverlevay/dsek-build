import{s as ue,r as fe,e as w,j as H,C as q,a as T,b as O,k as P,E as ae,d as C,f as g,i as U,q as v,Q as Ae,Y as Oe,l as Y,m as De,D as Le,F as se,P as ge,G as oe,w as Be,t as x,o as ee,S as ne,x as Ke,p as be}from"./scheduler.DK5noefF.js";import{S as ce,i as he,f as Ve,c as G,a as Q,m as J,t as V,b as j,d as X,g as ie,e as me}from"./index.OECaLbXR.js";import{e as le,u as ve,o as ke}from"./each.Dbd03sI1.js";import{p as He}from"./stores.BdoTh84D.js";import{g as Pe}from"./spread.CgU5AtxT.js";import{M as qe}from"./MemberSearch.DfsD4fsq.js";import{M as Ue}from"./MemberAvatar.DsenHHaP.js";import{g as K}from"./member.Deknk2Gk.js";import{s as je}from"./superForms.37TMp2uc.js";import{M as We}from"./MarkdownBody.Dj9odoYq.js";import{a as Z}from"./apiNames.G3FqMHey.js";import{i as $}from"./authorization.BfNSR1Nc.js";import{r as Me}from"./datetime.BjlMtXqc.js";function Ye(r){let e,n,s,i=[{autocomplete:"off"},{id:"comment"},{name:"content"},{type:"text"},{class:"input join-item input-bordered w-full"},{placeholder:"Kommentera något kul..."},r[4]],l={};for(let t=0;t<i.length;t+=1)l=Le(l,i[t]);return{c(){e=w("input"),this.h()},l(t){e=T(t,"INPUT",{autocomplete:!0,id:!0,name:!0,type:!0,class:!0,placeholder:!0}),this.h()},h(){se(e,l)},m(t,o){U(t,e,o),e.autofocus&&e.focus(),r[14](e),ge(e,r[5].content),n||(s=[oe(e,"input",r[15]),oe(e,"keypress",r[16]),oe(e,"input",r[17])],n=!0)},p(t,o){se(e,l=Pe(i,[{autocomplete:"off"},{id:"comment"},{name:"content"},{type:"text"},{class:"input join-item input-bordered w-full"},{placeholder:"Kommentera något kul..."},o&16&&t[4]])),o&32&&e.value!==t[5].content&&ge(e,t[5].content)},d(t){t&&C(e),r[14](null),n=!1,Be(s)}}}function ye(r){let e,n=r[6].content+"",s;return{c(){e=w("p"),s=x(n),this.h()},l(i){e=T(i,"P",{class:!0});var l=O(e);s=ee(l,n),l.forEach(C),this.h()},h(){g(e,"class","text-error")},m(i,l){U(i,e,l),v(e,s)},p(i,l){l&64&&n!==(n=i[6].content+"")&&ne(s,n)},d(i){i&&C(e)}}}function Ge(r){let e,n,s,i,l,t='<span class="label-text">Kommentera</span>',o,m,k,E,I,d,f="Skicka",c,F,S,A,R;n=new Ue({props:{member:r[0],class:"w-12 rounded-lg"}});function L(a){r[19](a)}let p={class:"dropdown-top flex-1",onSelect:r[18],$$slots:{default:[Ye]},$$scope:{ctx:r}};r[1]!==void 0&&(p.handleSearch=r[1]),k=new qe({props:p}),fe.push(()=>Ve(k,"handleSearch",L));let u=r[6].content&&ye(r);return{c(){e=w("div"),G(n.$$.fragment),s=H(),i=w("div"),l=w("label"),l.innerHTML=t,o=H(),m=w("form"),G(k.$$.fragment),I=H(),d=w("button"),d.textContent=f,c=H(),u&&u.c(),F=q(),this.h()},l(a){e=T(a,"DIV",{class:!0});var _=O(e);Q(n.$$.fragment,_),s=P(_),i=T(_,"DIV",{class:!0});var h=O(i);l=T(h,"LABEL",{class:!0,for:!0,"data-svelte-h":!0}),ae(l)!=="svelte-14efiw1"&&(l.innerHTML=t),o=P(h),m=T(h,"FORM",{class:!0,method:!0,action:!0});var b=O(m);Q(k.$$.fragment,b),I=P(b),d=T(b,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),ae(d)!=="svelte-1r94vh1"&&(d.textContent=f),b.forEach(C),h.forEach(C),_.forEach(C),c=P(a),u&&u.l(a),F=q(),this.h()},h(){g(l,"class","label w-auto self-start"),g(l,"for","comment"),g(d,"type","submit"),g(d,"class","btn btn-primary join-item"),g(m,"class","join join-horizontal w-full"),g(m,"method","POST"),g(m,"action",r[11]("?/comment",void 0)),g(i,"class","flex flex-1 flex-col flex-nowrap"),g(e,"class","flex items-end gap-4")},m(a,_){U(a,e,_),J(n,e,null),v(e,s),v(e,i),v(i,l),v(i,o),v(i,m),J(k,m,null),v(m,I),v(m,d),U(a,c,_),u&&u.m(a,_),U(a,F,_),S=!0,A||(R=Ae(r[10].call(null,m)),A=!0)},p(a,[_]){const h={};_&1&&(h.member=a[0]),n.$set(h);const b={};_&12&&(b.onSelect=a[18]),_&4194366&&(b.$$scope={dirty:_,ctx:a}),!E&&_&2&&(E=!0,b.handleSearch=a[1],Oe(()=>E=!1)),k.$set(b),a[6].content?u?u.p(a,_):(u=ye(a),u.c(),u.m(F.parentNode,F)):u&&(u.d(1),u=null)},i(a){S||(V(n.$$.fragment,a),V(k.$$.fragment,a),S=!0)},o(a){j(n.$$.fragment,a),j(k.$$.fragment,a),S=!1},d(a){a&&(C(e),C(c),C(F)),X(n),X(k),u&&u.d(a),A=!1,R()}}}function Qe(r,e,n){let s,i,l,{author:t}=e,{commentForm:o}=e;const{form:m,errors:k,constraints:E,enhance:I}=je(o,{resetForm:!0});Y(r,m,h=>n(5,i=h)),Y(r,k,h=>n(6,l=h)),Y(r,E,h=>n(4,s=h));const d=h=>{const b=`[@${K(h.member)}](/members/${h.member.studentId}) `;m.update(M=>(M.content.trim().startsWith("[@")||M.content.trim().length===0?M.content=b:M.content=`${b}${M.content}`,M))};let f,c=-1,F;const S=De("$paraglide-adapter-sveltekit:context");function A(h,b){return typeof h!="string"||!S?h:S.translateHref(h,b)}function R(h){fe[h?"unshift":"push"](()=>{F=h,n(3,F)})}function L(){i.content=this.value,m.set(i)}const p=h=>{h.key==="@"?n(2,c=h.currentTarget.selectionStart??-1):h.key==="Escape"&&n(2,c=-1)},u=h=>{if(c===-1)return;const b=h.currentTarget.value;if(b.lastIndexOf("@")!==c){n(2,c=-1),f("");return}const M=b.substring(c+1);f(M)},a=h=>{m.update(b=>(b.content=`${b.content.substring(0,c)}[@${K(h)}](/members/${h.studentId}) `,b)),F.focus()};function _(h){f=h,n(1,f)}return r.$$set=h=>{"author"in h&&n(0,t=h.author),"commentForm"in h&&n(12,o=h.commentForm)},[t,f,c,F,s,i,l,m,k,E,I,A,o,d,R,L,p,u,a,_]}class Je extends ce{constructor(e){super(),he(this,e,Qe,Ge,ue,{author:0,commentForm:12,onReply:13})}get onReply(){return this.$$.ctx[13]}}const Xe=/\[([^\]]*)\]\(\/members\/([^)]+)\)/g;function Ce(r){let e,n='<span class="i-mdi-reply text-xl"></span>',s,i;return{c(){e=w("button"),e.innerHTML=n,this.h()},l(l){e=T(l,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(e)!=="svelte-16tztez"&&(e.innerHTML=n),this.h()},h(){g(e,"class","btn btn-square btn-ghost btn-md")},m(l,t){U(l,e,t),s||(i=oe(e,"click",function(){Ke(r[3])&&r[3].apply(this,arguments)}),s=!0)},p(l,t){r=l},d(l){l&&C(e),s=!1,i()}}}function Ee(r){let e,n,s,i,l,t,o='<span class="i-mdi-delete text-xl"></span>',m,k,E=[{type:"hidden"},{name:"commentId"},{value:s=r[1].id},r[6].commentId],I={};for(let f=0;f<E.length;f+=1)I=Le(I,E[f]);let d=r[7].commentId&&Ie(r);return{c(){e=w("form"),n=w("input"),i=H(),d&&d.c(),l=H(),t=w("button"),t.innerHTML=o,this.h()},l(f){e=T(f,"FORM",{method:!0,action:!0});var c=O(e);n=T(c,"INPUT",{type:!0,name:!0}),i=P(c),d&&d.l(c),l=P(c),t=T(c,"BUTTON",{type:!0,class:!0,"data-svelte-h":!0}),ae(t)!=="svelte-l7tz6c"&&(t.innerHTML=o),c.forEach(C),this.h()},h(){se(n,I),g(t,"type","submit"),g(t,"class","btn btn-square btn-ghost btn-md"),g(e,"method","POST"),g(e,"action",r[11]("?/removeComment",void 0))},m(f,c){U(f,e,c),v(e,n),n.autofocus&&n.focus(),v(e,i),d&&d.m(e,null),v(e,l),v(e,t),m||(k=Ae(r[10].call(null,e)),m=!0)},p(f,c){se(n,I=Pe(E,[{type:"hidden"},{name:"commentId"},c&2&&s!==(s=f[1].id)&&{value:s},c&64&&f[6].commentId])),f[7].commentId?d?d.p(f,c):(d=Ie(f),d.c(),d.m(e,l)):d&&(d.d(1),d=null)},d(f){f&&C(e),d&&d.d(),m=!1,k()}}}function Ie(r){let e,n=r[7].commentId+"",s;return{c(){e=w("p"),s=x(n),this.h()},l(i){e=T(i,"P",{class:!0});var l=O(e);s=ee(l,n),l.forEach(C),this.h()},h(){g(e,"class","text-error")},m(i,l){U(i,e,l),v(e,s)},p(i,l){l&128&&n!==(n=i[7].commentId+"")&&ne(s,n)},d(i){i&&C(e)}}}function Ze(r){var _e;let e,n,s,i,l,t,o,m,k=K(r[2])+"",E,I,d,f,c,F=Me(r[1].published)+"",S,A,R,L=$(Z[r[0]].COMMENT,r[5].data.user),p,u=$(Z[r[0]].COMMENT_DELETE,r[5].data.user)||r[1].memberId===((_e=r[5].data.user)==null?void 0:_e.memberId),a,_,h,b;i=new Ue({props:{member:r[2],class:"w-8 rounded-lg"}});let M=L&&Ce(r),D=u&&Ee(r);return _=new We({props:{body:r[4]}}),{c(){e=w("section"),n=w("div"),s=w("a"),G(i.$$.fragment),t=H(),o=w("div"),m=w("a"),E=x(k),f=H(),c=w("span"),S=x(F),A=H(),R=w("div"),M&&M.c(),p=H(),D&&D.c(),a=H(),G(_.$$.fragment),this.h()},l(y){e=T(y,"SECTION",{"aria-label":!0,class:!0,id:!0});var N=O(e);n=T(N,"DIV",{class:!0});var B=O(n);s=T(B,"A",{href:!0});var te=O(s);Q(i.$$.fragment,te),te.forEach(C),t=P(B),o=T(B,"DIV",{class:!0});var W=O(o);m=T(W,"A",{href:!0,class:!0,title:!0});var de=O(m);E=ee(de,k),de.forEach(C),f=P(W),c=T(W,"SPAN",{class:!0});var pe=O(c);S=ee(pe,F),pe.forEach(C),W.forEach(C),A=P(B),R=T(B,"DIV",{class:!0});var re=O(R);M&&M.l(re),p=P(re),D&&D.l(re),re.forEach(C),B.forEach(C),a=P(N),Q(_.$$.fragment,N),N.forEach(C),this.h()},h(){g(s,"href",l=r[11](`/members/${r[2].studentId}`,void 0)),g(m,"href",I=r[11](`/members/${r[2].studentId}`,void 0)),g(m,"class","link link-primary block truncate no-underline"),g(m,"title",d=K(r[2])),g(c,"class","font-semibold opacity-50"),g(o,"class","min-w-0 text-xs"),g(R,"class","flex gap-1"),g(n,"class","grid grid-cols-[auto_1fr_auto] items-start gap-2"),g(e,"aria-label",h="Comment by "+K(r[2])),g(e,"class","relative mb-4"),g(e,"id","comment-section")},m(y,N){U(y,e,N),v(e,n),v(n,s),J(i,s,null),v(n,t),v(n,o),v(o,m),v(m,E),v(o,f),v(o,c),v(c,S),v(n,A),v(n,R),M&&M.m(R,null),v(R,p),D&&D.m(R,null),v(e,a),J(_,e,null),b=!0},p(y,[N]){var W;const B={};N&4&&(B.member=y[2]),i.$set(B),(!b||N&4&&l!==(l=y[11](`/members/${y[2].studentId}`,void 0)))&&g(s,"href",l),(!b||N&4)&&k!==(k=K(y[2])+"")&&ne(E,k),(!b||N&4&&I!==(I=y[11](`/members/${y[2].studentId}`,void 0)))&&g(m,"href",I),(!b||N&4&&d!==(d=K(y[2])))&&g(m,"title",d),(!b||N&2)&&F!==(F=Me(y[1].published)+"")&&ne(S,F),N&33&&(L=$(Z[y[0]].COMMENT,y[5].data.user)),L?M?M.p(y,N):(M=Ce(y),M.c(),M.m(R,p)):M&&(M.d(1),M=null),N&35&&(u=$(Z[y[0]].COMMENT_DELETE,y[5].data.user)||y[1].memberId===((W=y[5].data.user)==null?void 0:W.memberId)),u?D?D.p(y,N):(D=Ee(y),D.c(),D.m(R,null)):D&&(D.d(1),D=null);const te={};N&16&&(te.body=y[4]),_.$set(te),(!b||N&4&&h!==(h="Comment by "+K(y[2])))&&g(e,"aria-label",h)},i(y){b||(V(i.$$.fragment,y),V(_.$$.fragment,y),b=!0)},o(y){j(i.$$.fragment,y),j(_.$$.fragment,y),b=!1},d(y){y&&C(e),X(i),M&&M.d(),D&&D.d(),X(_)}}}function $e(r,e,n){let s,i,l,t;Y(r,He,p=>n(5,i=p));let{type:o}=e,{comment:m}=e,{author:k}=e,{taggedMembers:E}=e,{onReply:I}=e,{removeCommentForm:d}=e;const{errors:f,constraints:c,enhance:F}=je(d,{id:m.id});Y(r,f,p=>n(7,t=p)),Y(r,c,p=>n(6,l=p));const S=p=>{const u=E.find(a=>a.studentId===p);return u?`@${K(u)}`:"@Unknown User"};function A(p){return p.replace(Xe,(u,a,_)=>`[${S(_)}](/members/${_})`)}const R=De("$paraglide-adapter-sveltekit:context");function L(p,u){return typeof p!="string"||!R?p:R.translateHref(p,u)}return r.$$set=p=>{"type"in p&&n(0,o=p.type),"comment"in p&&n(1,m=p.comment),"author"in p&&n(2,k=p.author),"taggedMembers"in p&&n(12,E=p.taggedMembers),"onReply"in p&&n(3,I=p.onReply),"removeCommentForm"in p&&n(13,d=p.removeCommentForm)},r.$$.update=()=>{r.$$.dirty&2&&n(4,s=A(m.content??""))},[o,m,k,I,s,i,l,t,f,c,F,L,E,d]}class ze extends ce{constructor(e){super(),he(this,e,$e,Ze,ue,{type:0,comment:1,author:2,taggedMembers:12,onReply:3,removeCommentForm:13})}}function we(r,e,n){const s=r.slice();return s[10]=e[n],s}function Te(r,e,n){const s=r.slice();return s[10]=e[n],s}function Fe(r){let e,n,s,i,l=[],t=new Map,o,m,k,E=r[0].length>z?`(tryck för att visa ${r[0].length-z} till)`:"",I,d,f,c=[],F=new Map,S,A=le(r[0].slice(r[0].length-z));const R=u=>u[10].id;for(let u=0;u<A.length;u+=1){let a=Te(r,A,u),_=R(a);t.set(_,l[u]=Se(_,a))}let L=le(r[0].slice(0,r[0].length-z));const p=u=>u[10].id;for(let u=0;u<L.length;u+=1){let a=we(r,L,u),_=p(a);F.set(_,c[u]=Re(_,a))}return{c(){e=w("div"),n=w("input"),s=H(),i=w("div");for(let u=0;u<l.length;u+=1)l[u].c();o=H(),m=w("div"),k=x("Kommentarer "),I=x(E),d=H(),f=w("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){e=T(u,"DIV",{class:!0});var a=O(e);n=T(a,"INPUT",{type:!0}),s=P(a),i=T(a,"DIV",{class:!0});var _=O(i);for(let M=0;M<l.length;M+=1)l[M].l(_);_.forEach(C),o=P(a),m=T(a,"DIV",{class:!0});var h=O(m);k=ee(h,"Kommentarer "),I=ee(h,E),h.forEach(C),d=P(a),f=T(a,"DIV",{class:!0});var b=O(f);for(let M=0;M<c.length;M+=1)c[M].l(b);b.forEach(C),a.forEach(C),this.h()},h(){g(n,"type","checkbox"),g(i,"class","px-4"),g(m,"class","collapse-title text-xl font-medium"),g(f,"class","collapse-content !pb-0"),g(e,"class","collapse bg-base-200"),be(e,"collapse-open",r[0].length<=z)},m(u,a){U(u,e,a),v(e,n),v(e,s),v(e,i);for(let _=0;_<l.length;_+=1)l[_]&&l[_].m(i,null);v(e,o),v(e,m),v(m,k),v(m,I),v(e,d),v(e,f);for(let _=0;_<c.length;_+=1)c[_]&&c[_].m(f,null);S=!0},p(u,a){a&55&&(A=le(u[0].slice(u[0].length-z)),ie(),l=ve(l,a,R,1,u,A,t,i,ke,Se,null,Te),me()),(!S||a&1)&&E!==(E=u[0].length>z?`(tryck för att visa ${u[0].length-z} till)`:"")&&ne(I,E),a&55&&(L=le(u[0].slice(0,u[0].length-z)),ie(),c=ve(c,a,p,1,u,L,F,f,ke,Re,null,we),me()),(!S||a&1)&&be(e,"collapse-open",u[0].length<=z)},i(u){if(!S){for(let a=0;a<A.length;a+=1)V(l[a]);for(let a=0;a<L.length;a+=1)V(c[a]);S=!0}},o(u){for(let a=0;a<l.length;a+=1)j(l[a]);for(let a=0;a<c.length;a+=1)j(c[a]);S=!1},d(u){u&&C(e);for(let a=0;a<l.length;a+=1)l[a].d();for(let a=0;a<c.length;a+=1)c[a].d()}}}function Se(r,e){let n,s,i;function l(){return e[7](e[10])}return s=new ze({props:{comment:e[10],author:e[10].member,taggedMembers:e[2],onReply:l,type:e[1],removeCommentForm:e[4]}}),{key:r,first:null,c(){n=q(),G(s.$$.fragment),this.h()},l(t){n=q(),Q(s.$$.fragment,t),this.h()},h(){this.first=n},m(t,o){U(t,n,o),J(s,t,o),i=!0},p(t,o){e=t;const m={};o&1&&(m.comment=e[10]),o&1&&(m.author=e[10].member),o&4&&(m.taggedMembers=e[2]),o&33&&(m.onReply=l),o&2&&(m.type=e[1]),o&16&&(m.removeCommentForm=e[4]),s.$set(m)},i(t){i||(V(s.$$.fragment,t),i=!0)},o(t){j(s.$$.fragment,t),i=!1},d(t){t&&C(n),X(s,t)}}}function Re(r,e){let n,s,i;function l(){return e[8](e[10])}return s=new ze({props:{comment:e[10],author:e[10].member,taggedMembers:e[2],onReply:l,type:e[1],removeCommentForm:e[4]}}),{key:r,first:null,c(){n=q(),G(s.$$.fragment),this.h()},l(t){n=q(),Q(s.$$.fragment,t),this.h()},h(){this.first=n},m(t,o){U(t,n,o),J(s,t,o),i=!0},p(t,o){e=t;const m={};o&1&&(m.comment=e[10]),o&1&&(m.author=e[10].member),o&4&&(m.taggedMembers=e[2]),o&33&&(m.onReply=l),o&2&&(m.type=e[1]),o&16&&(m.removeCommentForm=e[4]),s.$set(m)},i(t){i||(V(s.$$.fragment,t),i=!0)},o(t){j(s.$$.fragment,t),i=!1},d(t){t&&C(n),X(s,t)}}}function Ne(r){let e,n,s;function i(t){r[9](t)}let l={author:r[6].data.member,commentForm:r[3]};return r[5]!==void 0&&(l.onReply=r[5]),e=new Je({props:l}),fe.push(()=>Ve(e,"onReply",i)),{c(){G(e.$$.fragment)},l(t){Q(e.$$.fragment,t)},m(t,o){J(e,t,o),s=!0},p(t,o){const m={};o&64&&(m.author=t[6].data.member),o&8&&(m.commentForm=t[3]),!n&&o&32&&(n=!0,m.onReply=t[5],Oe(()=>n=!1)),e.$set(m)},i(t){s||(V(e.$$.fragment,t),s=!0)},o(t){j(e.$$.fragment,t),s=!1},d(t){X(e,t)}}}function xe(r){let e,n=$(Z[r[1]].COMMENT,r[6].data.user)&&r[6].data.member,s,i,l=r[0].length>0&&Fe(r),t=n&&Ne(r);return{c(){l&&l.c(),e=H(),t&&t.c(),s=q()},l(o){l&&l.l(o),e=P(o),t&&t.l(o),s=q()},m(o,m){l&&l.m(o,m),U(o,e,m),t&&t.m(o,m),U(o,s,m),i=!0},p(o,[m]){o[0].length>0?l?(l.p(o,m),m&1&&V(l,1)):(l=Fe(o),l.c(),V(l,1),l.m(e.parentNode,e)):l&&(ie(),j(l,1,1,()=>{l=null}),me()),m&66&&(n=$(Z[o[1]].COMMENT,o[6].data.user)&&o[6].data.member),n?t?(t.p(o,m),m&66&&V(t,1)):(t=Ne(o),t.c(),V(t,1),t.m(s.parentNode,s)):t&&(ie(),j(t,1,1,()=>{t=null}),me())},i(o){i||(V(l),V(t),i=!0)},o(o){j(l),j(t),i=!1},d(o){o&&(C(e),C(s)),l&&l.d(o),t&&t.d(o)}}}const z=3;function et(r,e,n){let s;Y(r,He,f=>n(6,s=f));let{comments:i}=e,{type:l}=e,{taggedMembers:t}=e,{commentForm:o}=e,{removeCommentForm:m}=e,k;const E=f=>k(f),I=f=>k(f);function d(f){k=f,n(5,k)}return r.$$set=f=>{"comments"in f&&n(0,i=f.comments),"type"in f&&n(1,l=f.type),"taggedMembers"in f&&n(2,t=f.taggedMembers),"commentForm"in f&&n(3,o=f.commentForm),"removeCommentForm"in f&&n(4,m=f.removeCommentForm)},[i,l,t,o,m,k,s,E,I,d]}class _t extends ce{constructor(e){super(),he(this,e,et,xe,ue,{comments:0,type:1,taggedMembers:2,commentForm:3,removeCommentForm:4})}}export{_t as C};
