var D=Object.defineProperty;var H=(o,e,t)=>e in o?D(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var m=(o,e,t)=>H(o,typeof e!="symbol"?e+"":e,t);import{a2 as J,a8 as C,s as W,C as E,i as R,d,l as A,e as v,a as w,b,f as p,t as B,j as G,o as K,k as Q,p as h,q as S,S as X}from"./scheduler.DK5noefF.js";import{S as Y,i as Z,t as _,g as q,b as T,e as j,h as $}from"./index.OECaLbXR.js";import{e as F,u as ee,o as te}from"./each.Dbd03sI1.js";import{n as se,p as O}from"./stores.BdoTh84D.js";import{a as ae,t as N}from"./toast.BUMyavxw.js";import{f as oe}from"./index.Cq-ibvhb.js";import{w as ie}from"./index.BanBdRDU.js";import{e as re,c as ne}from"./123.BVaw0gZK.js";const le=encodeURIComponent,g=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function ue(o,e,t){let s=t||{},a=s.encode||le;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!g.test(o))throw new TypeError("argument name is invalid");let i=a(e);if(i&&!g.test(i))throw new TypeError("argument val is invalid");let l=o+"="+i;if(s.maxAge!=null){let c=s.maxAge-0;if(isNaN(c)||!isFinite(c))throw new TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(c)}if(s.domain){if(!g.test(s.domain))throw new TypeError("option domain is invalid");l+="; Domain="+s.domain}if(s.path){if(!g.test(s.path))throw new TypeError("option path is invalid");l+="; Path="+s.path}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");l+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(l+="; HttpOnly"),s.secure&&(l+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"strict":l+="; SameSite=Strict";break;case"none":l+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return l}const fe={clearArray:!1,clearOnNavigate:!0,clearAfterMs:0,flashCookieOptions:{path:"/",maxAge:120,httpOnly:!1,sameSite:"strict"}};function ce(o,e){return{...o,...e,flashCookieOptions:{...o.flashCookieOptions,...e==null?void 0:e.flashCookieOptions}}}class x{constructor(e,t){m(this,"options");m(this,"_message");m(this,"_flashTimeout",0);this.options=t??fe,this._message={subscribe:e.subscribe,set:(s,a)=>e.update(i=>this.update(i,s,(a==null?void 0:a.concatenateArray)??!1)),update:(s,a)=>e.update(i=>this.update(i,s(i),(a==null?void 0:a.concatenateArray)??!1))}}get message(){return this._message}get flashTimeout(){return this._flashTimeout}update(e,t,s=!1){return this._flashTimeout&&clearTimeout(this.flashTimeout),s&&Array.isArray(t)&&Array.isArray(e)?e.length>0&&t.length>0&&e[e.length-1]===t[t.length-1]?e:e.concat(t):(t!==void 0&&this.options.clearAfterMs&&(this._flashTimeout=setTimeout(()=>{this.message.set(void 0)},this.options.clearAfterMs)),t)}}class he{constructor(){m(this,"routes",new Map);m(this,"messageStore");this.messageStore=ie(),this.routes.set("",new x(this.messageStore)),J(()=>{for(const e of this.routes.values())clearTimeout(e.flashTimeout)})}get defaultRoute(){return this.routes.get("")}has(e){return this.routes.has(e)}getFlashMessage(e){return e?this.routes.has(e)?this.routes.get(e):this.getClosestRoute(e):this.defaultRoute}getClosestRoute(e){const t=Array.from(this.routes.keys()).filter(a=>e.includes(a));if(!t.length)return this.defaultRoute;const s=t.reduce((a,i)=>i.length>a.length?i:a);return this.routes.get(s)}createRoute(e,t,s){const a=this.getClosestRoute(e),i=new x(this.messageStore,ce(a.options,s));return i.message.set(t),this.routes.set(e,i),i}}const y="flash",P=new WeakMap;function k(o,e){let t=P.get(o);return t||(t=new he,P.set(o,t),t.getFlashMessage(C(o).route.id).message.set(e),pe(o)),t}function pe(o){o.subscribe(e=>{const t=z();if(t!==void 0){const s=k(o).getFlashMessage(e.route.id);s.message.set(t,{concatenateArray:!s.options.clearArray}),U(s.options.flashCookieOptions)}}),re(e=>{var s,a;const t=(s=e==null?void 0:e.to)==null?void 0:s.route.id;if(t){const i=k(o).getFlashMessage(t);i.options.clearOnNavigate&&((a=e.from)==null?void 0:a.route.id)!=t&&i.message.set(void 0)}}),ne(()=>{const e=z();if(e!==void 0){const t=k(o).getFlashMessage(C(o).route.id);t.message.set(e,{concatenateArray:!t.options.clearArray}),U(t.options.flashCookieOptions)}})}function me(o,e){const t=C(o),s=k(o,t.data.flash);function a(){const r=s.routes.get(f());return r||(e?i():s.getClosestRoute(f()))}function i(){return s.createRoute(f(),c(),e)}const l={store:o,route:t.route.id,initialdata:t.data.flash,navigating:se};function c(){return l.initialdata}function f(){return l.route??""}return a()}function de(o,e){return me(o,e).message}function U(o){document.cookie=ue(y,"",{...o,maxAge:0})}function z(){const o=document.cookie;if(!o||!o.includes(y+"="))return;function e(s){const a={};return s?s.split(";").map(i=>i.split("=")).reduce((i,l)=>(i[decodeURIComponent(l[0].trim())]=decodeURIComponent(l[1].trim()),i),a):a}const t=e(o);if(t[y])try{return JSON.parse(t[y])}catch{}}function I(o,e,t){const s=o.slice();return s[5]=e[t],s}function L(o){let e,t=[],s=new Map,a,i,l,c=F(o[2]);const f=r=>r[5].id;for(let r=0;r<c.length;r+=1){let n=I(o,c,r),u=f(n);s.set(u,t[r]=V(u,n))}return{c(){e=v("div");for(let r=0;r<t.length;r+=1)t[r].c();this.h()},l(r){e=w(r,"DIV",{class:!0,style:!0});var n=b(e);for(let u=0;u<t.length;u+=1)t[u].l(n);n.forEach(d),this.h()},h(){var r;p(e,"class",a="toast z-10 "+o[1]),p(e,"style",i=o[0].data.isApp?`top: ${64+(((r=o[0].data.appInfo)==null?void 0:r.insets.top)??0)}px;`:"")},m(r,n){R(r,e,n);for(let u=0;u<t.length;u+=1)t[u]&&t[u].m(e,null);l=!0},p(r,n){var u;n&5&&(c=F(r[2]),q(),t=ee(t,n,f,1,r,c,s,e,te,V,null,I),j()),(!l||n&2&&a!==(a="toast z-10 "+r[1]))&&p(e,"class",a),(!l||n&1&&i!==(i=r[0].data.isApp?`top: ${64+(((u=r[0].data.appInfo)==null?void 0:u.insets.top)??0)}px;`:""))&&p(e,"style",i)},i(r){if(!l){for(let n=0;n<c.length;n+=1)_(t[n]);l=!0}},o(r){for(let n=0;n<t.length;n+=1)T(t[n]);l=!1},d(r){r&&d(e);for(let n=0;n<t.length;n+=1)t[n].d()}}}function V(o,e){let t,s,a=e[5].message+"",i,l,c,f,r;return{key:o,first:null,c(){t=v("div"),s=v("span"),i=B(a),l=G(),this.h()},l(n){t=w(n,"DIV",{role:!0,class:!0});var u=b(t);s=w(u,"SPAN",{class:!0});var M=b(s);i=K(M,a),M.forEach(d),l=Q(u),u.forEach(d),this.h()},h(){p(s,"class","max-w-full select-all overflow-hidden text-ellipsis"),p(t,"role","alert"),p(t,"class",c="alert alert-"+e[5].type+" select-all"),h(t,"py-2",e[0].data.isApp),h(t,"px-6",e[0].data.isApp),h(t,"text-sm",e[0].data.isApp),h(t,"w-auto",e[0].data.isApp),this.first=t},m(n,u){R(n,t,u),S(t,s),S(s,i),S(t,l),r=!0},p(n,u){e=n,(!r||u&4)&&a!==(a=e[5].message+"")&&X(i,a),(!r||u&4&&c!==(c="alert alert-"+e[5].type+" select-all"))&&p(t,"class",c),(!r||u&5)&&h(t,"py-2",e[0].data.isApp),(!r||u&5)&&h(t,"px-6",e[0].data.isApp),(!r||u&5)&&h(t,"text-sm",e[0].data.isApp),(!r||u&5)&&h(t,"w-auto",e[0].data.isApp)},i(n){r||(f&&f.end(1),r=!0)},o(n){n&&(f=$(t,oe,{duration:750})),r=!1},d(n){n&&d(t),n&&f&&f.end()}}}function ge(o){let e,t,s=o[2].length>0&&L(o);return{c(){s&&s.c(),e=E()},l(a){s&&s.l(a),e=E()},m(a,i){s&&s.m(a,i),R(a,e,i),t=!0},p(a,[i]){a[2].length>0?s?(s.p(a,i),i&4&&_(s,1)):(s=L(a),s.c(),_(s,1),s.m(e.parentNode,e)):s&&(q(),T(s,1,1,()=>{s=null}),j())},i(a){t||(_(s),t=!0)},o(a){T(s),t=!1},d(a){a&&d(e),s&&s.d(a)}}}function _e(o,e,t){let s,a,i,l;A(o,O,f=>t(0,a=f)),A(o,ae,f=>t(2,l=f));const c=de(O);return A(o,c,f=>t(4,i=f)),o.$$.update=()=>{var f,r;o.$$.dirty&1&&(r=(f=a.form)==null?void 0:f.form)!=null&&r.message&&a.form.form.message.type!=="hidden"&&N(a.form.form.message.message,a.form.form.message.type,a.form.form.message.id),o.$$.dirty&16&&i&&i.type!=="hidden"&&N(i.message,i.type,i.id),o.$$.dirty&1&&t(1,s=a.data.isApp?"toast-top toast-center w-full flex-col-reverse items-center":"bottom-2 right-2")},[a,s,l,c,i]}class Re extends Y{constructor(e){super(),Z(this,e,_e,ge,W,{})}}export{Re as T};
