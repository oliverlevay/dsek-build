import{t as Rt}from"./toast.BUMyavxw.js";import{w as q,d as de,a as Pe}from"./index.BanBdRDU.js";import{p as pe,n as Ke}from"./stores.BdoTh84D.js";import{a2 as we,$ as je,a8 as ae}from"./scheduler.DK5noefF.js";import{U as ct,N as Lt,P as Ut,f as Ht,h as ft,H as $t,e as qt,i as Bt,a as De,g as zt}from"./123.BVaw0gZK.js";import{b as dt}from"./index.Bt-Xh7oU.js";import{e as Yt,d as Xe}from"./forms.DDTWXYJD.js";import"./index.DQfRr7yB.js";class Qe extends Error{constructor(i,s){super(i),this.name="DevalueError",this.path=s.join("")}}function et(r){return Object(r)!==r}const Wt=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Gt(r){const i=Object.getPrototypeOf(r);return i===Object.prototype||i===null||Object.getOwnPropertyNames(i).sort().join("\0")===Wt}function Zt(r){return Object.prototype.toString.call(r).slice(8,-1)}function Jt(r){switch(r){case'"':return'\\"';case"<":return"\\u003C";case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"	":return"\\t";case"\b":return"\\b";case"\f":return"\\f";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return r<" "?`\\u${r.charCodeAt(0).toString(16).padStart(4,"0")}`:""}}function fe(r){let i="",s=0;const t=r.length;for(let l=0;l<t;l+=1){const u=r[l],a=Jt(u);a&&(i+=r.slice(s,l)+a,s=l+1)}return`"${s===0?r:i+r.slice(s)}"`}function Kt(r,i){const s=[],t=new Map,l=[];for(const c in i)l.push({key:c,fn:i[c]});const u=[];let a=0;function p(c){if(typeof c=="function")throw new Qe("Cannot stringify a function",u);if(t.has(c))return t.get(c);if(c===void 0)return ct;if(Number.isNaN(c))return Lt;if(c===1/0)return Ut;if(c===-1/0)return Ht;if(c===0&&1/c<0)return ft;const m=a++;t.set(c,m);for(const{key:_,fn:T}of l){const J=T(c);if(J)return s[m]=`["${_}",${p(J)}]`,m}let f="";if(et(c))f=Oe(c);else switch(Zt(c)){case"Number":case"String":case"Boolean":f=`["Object",${Oe(c)}]`;break;case"BigInt":f=`["BigInt",${c}]`;break;case"Date":f=`["Date","${!isNaN(c.getDate())?c.toISOString():""}"]`;break;case"RegExp":const{source:J,flags:K}=c;f=K?`["RegExp",${fe(J)},"${K}"]`:`["RegExp",${fe(J)}]`;break;case"Array":f="[";for(let S=0;S<c.length;S+=1)S>0&&(f+=","),S in c?(u.push(`[${S}]`),f+=p(c[S]),u.pop()):f+=$t;f+="]";break;case"Set":f='["Set"';for(const S of c)f+=`,${p(S)}`;f+="]";break;case"Map":f='["Map"';for(const[S,U]of c)u.push(`.get(${et(S)?Oe(S):"..."})`),f+=`,${p(S)},${p(U)}`,u.pop();f+="]";break;default:if(!Gt(c))throw new Qe("Cannot stringify arbitrary non-POJOs",u);if(Object.getPrototypeOf(c)===null){f='["null"';for(const S in c)u.push(`.${S}`),f+=`,${fe(S)},${p(c[S])}`,u.pop();f+="]"}else{f="{";let S=!1;for(const U in c)S&&(f+=","),S=!0,u.push(`.${U}`),f+=`${fe(U)}:${p(c[U])}`,u.pop();f+="}"}}return s[m]=f,m}const y=p(r);return y<0?`${y}`:`[${s.join(",")}]`}function Oe(r){const i=typeof r;return i==="string"?fe(r):r instanceof String?fe(r.toString()):r===void 0?ct.toString():r===0&&1/r<0?ft.toString():i==="bigint"?`["BigInt","${r}"]`:String(r)}var Xt=ye;function ye(r){let i=r;var s={}.toString.call(r).slice(8,-1);if(s=="Set")return new Set([...r].map(l=>ye(l)));if(s=="Map")return new Map([...r].map(l=>[ye(l[0]),ye(l[1])]));if(s=="Date")return new Date(r.getTime());if(s=="RegExp")return RegExp(r.source,Qt(r));if(s=="Array"||s=="Object"){i=Array.isArray(r)?[]:{};for(var t in r)i[t]=ye(r[t])}return i}function Qt(r){if(typeof r.source.flags=="string")return r.source.flags;var i=[];return r.global&&i.push("g"),r.ignoreCase&&i.push("i"),r.multiline&&i.push("m"),r.sticky&&i.push("y"),r.unicode&&i.push("u"),i.join("")}function xe(r,i,s){return r[i]=s,"skip"}function er(r,i){return i.value!==void 0&&typeof i.value!="object"&&i.path.length<r.length}function Q(r,i,s={}){s.modifier||(s.modifier=l=>er(i,l)?void 0:l.value);const t=L(r,i,s.modifier);if(t)return s.value===void 0||s.value(t.value)?t:void 0}function L(r,i,s){if(!i.length)return;const t=[i[0]];let l=r;for(;l&&t.length<i.length;){const a=t[t.length-1],p=s?s({parent:l,key:String(a),value:l[a],path:t.map(y=>String(y)),isLeaf:!1,set:y=>xe(l,a,y)}):l[a];if(p===void 0)return;l=p,t.push(i[t.length])}if(!l)return;const u=i[i.length-1];return{parent:l,key:String(u),value:l[u],path:i.map(a=>String(a)),isLeaf:!0,set:a=>xe(l,u,a)}}function ee(r,i,s=[]){for(const t in r){const l=r[t],u=l===null||typeof l!="object",a={parent:r,key:t,value:l,path:s.concat([t]),isLeaf:u,set:y=>xe(r,t,y)},p=i(a);if(p==="abort")return p;if(p==="skip")continue;if(!u){const y=ee(l,i,a.path);if(y==="abort")return y}}}function tr(r,i){return r===i||r.size===i.size&&[...r].every(s=>i.has(s))}function tt(r,i){const s=new Map;function t(a,p){return a instanceof Date&&p instanceof Date&&a.getTime()!==p.getTime()||a instanceof Set&&p instanceof Set&&!tr(a,p)||a instanceof File&&p instanceof File&&a!==p}function l(a){return a instanceof Date||a instanceof Set||a instanceof File}function u(a,p){const y=p?L(p,a.path):void 0;function c(){return s.set(a.path.join(" "),a.path),"skip"}if(l(a.value)&&(!l(y==null?void 0:y.value)||t(a.value,y.value)))return c();a.isLeaf&&(!y||a.value!==y.value)&&c()}return ee(r,a=>u(a,i)),ee(i,a=>u(a,r)),Array.from(s.values())}function G(r,i,s){const t=typeof s=="function";for(const l of i){const u=L(r,l,({parent:a,key:p,value:y})=>((y===void 0||typeof y!="object")&&(a[p]={}),a[p]));u&&(u.parent[u.key]=t?s(l,u):s)}}function ne(r){return r.toString().split(/[[\].]+/).filter(i=>i)}function ge(r){return r.reduce((i,s)=>{const t=String(s);return typeof s=="number"||/^\d+$/.test(t)?i+=`[${t}]`:i?i+=`.${t}`:i+=t,i},"")}class F extends Error{constructor(i){super(i),Object.setPrototypeOf(this,F.prototype)}}function rr(r,i){var l;const s={};function t(u){if("_errors"in s||(s._errors=[]),!Array.isArray(s._errors))if(typeof s._errors=="string")s._errors=[s._errors];else throw new F("Form-level error was not an array.");s._errors.push(u.message)}for(const u of r){if(!u.path||u.path.length==1&&!u.path[0]){t(u);continue}const p=!/^\d$/.test(String(u.path[u.path.length-1]))&&((l=Q(i,u.path.filter(f=>/\D/.test(String(f)))))==null?void 0:l.value),y=L(s,u.path,({value:f,parent:_,key:T})=>(f===void 0&&(_[T]={}),_[T]));if(!y){t(u);continue}const{parent:c,key:m}=y;p?(m in c||(c[m]={}),"_errors"in c[m]?c[m]._errors.push(u.message):c[m]._errors=[u.message]):m in c?c[m].push(u.message):c[m]=[u.message]}return s}function rt(r,i,s){return s?r:(ee(i,t=>{Array.isArray(t.value)&&t.set(void 0)}),ee(r,t=>{!Array.isArray(t.value)&&t.value!==void 0||G(i,[t.path],t.value)}),i)}function nr(r){return mt(r,[])}function mt(r,i){return Object.entries(r).filter(([,t])=>t!==void 0).flatMap(([t,l])=>{if(Array.isArray(l)&&l.length>0){const u=i.concat([t]);return{path:ge(u),messages:l}}else return mt(r[t],i.concat([t]))})}function V(r){return r&&typeof r=="object"?Xt(r):r}function nt(r){!r.flashMessage||!dt||Ne(r)&&(document.cookie=`flash=; Max-Age=0; Path=${r.flashMessage.cookiePath??"/"};`)}function Ne(r){return!r.flashMessage||!dt?!1:r.syncFlashMessage}const pt="noCustomValidity";async function it(r,i){"setCustomValidity"in r&&r.setCustomValidity(""),!(pt in r.dataset)&&yt(r,i)}function ir(r,i){for(const s of r.querySelectorAll("input,select,textarea,button")){if("dataset"in s&&pt in s.dataset||!s.name)continue;const t=L(i,ne(s.name)),l=t&&typeof t.value=="object"&&"_errors"in t.value?t.value._errors:t==null?void 0:t.value;if(yt(s,l),l)return}}function yt(r,i){const s=i&&i.length?i.join(`
`):"";r.setCustomValidity(s),s&&r.reportValidity()}const sr=(r,i=0)=>{const s=r.getBoundingClientRect();return s.top>=i&&s.left>=0&&s.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&s.right<=(window.innerWidth||document.documentElement.clientWidth)},ar=(r,i=1.125,s="smooth")=>{const u=r.getBoundingClientRect().top+window.pageYOffset-window.innerHeight/(2*i);window.scrollTo({left:0,top:u,behavior:s})},or=["checkbox","radio","range","file"];function st(r){const i=!!r&&(r instanceof HTMLSelectElement||r instanceof HTMLInputElement&&or.includes(r.type)),s=!!r&&r instanceof HTMLSelectElement&&r.multiple,t=!!r&&r instanceof HTMLInputElement&&r.type=="file";return{immediate:i,multiple:s,file:t}}var O;(function(r){r[r.Idle=0]="Idle",r[r.Submitting=1]="Submitting",r[r.Delayed=2]="Delayed",r[r.Timeout=3]="Timeout"})(O||(O={}));const ur=new Set;function lr(r,i,s){let t=O.Idle,l,u;const a=ur;function p(){y(),m(t!=O.Delayed?O.Submitting:O.Delayed),l=window.setTimeout(()=>{l&&t==O.Submitting&&m(O.Delayed)},s.delayMs),u=window.setTimeout(()=>{u&&t==O.Delayed&&m(O.Timeout)},s.timeoutMs),a.add(y)}function y(){clearTimeout(l),clearTimeout(u),l=u=0,a.delete(y),m(O.Idle)}function c(){a.forEach(S=>S()),a.clear()}function m(S){t=S,i.submitting.set(t>=O.Submitting),i.delayed.set(t>=O.Delayed),i.timeout.set(t>=O.Timeout)}const f=r;function _(S){const U=S.target;s.selectErrorText&&U.select()}function T(){s.selectErrorText&&f.querySelectorAll("input").forEach(S=>{S.addEventListener("invalid",_)})}function J(){s.selectErrorText&&f.querySelectorAll("input").forEach(S=>S.removeEventListener("invalid",_))}const K=r;{T();const S=U=>{U.clearAll?c():y(),U.cancelled||setTimeout(()=>Ce(K,s),1)};return we(()=>{J(),S({cancelled:!0})}),{submitting(){p()},completed:S,scrollToFirstError(){setTimeout(()=>Ce(K,s),1)},isSubmitting:()=>t===O.Submitting||t===O.Delayed}}}const Ce=async(r,i)=>{if(i.scrollToError=="off")return;const s=i.errorSelector;if(!s)return;await je();let t;if(t=r.querySelector(s),!t)return;t=t.querySelector(s)??t;const l=i.stickyNavbar?document.querySelector(i.stickyNavbar):null;typeof i.scrollToError!="string"?t.scrollIntoView(i.scrollToError):sr(t,(l==null?void 0:l.offsetHeight)??0)||ar(t,void 0,i.scrollToError);function u(p){return typeof i.autoFocusOnError=="boolean"?i.autoFocusOnError:!/iPhone|iPad|iPod|Android/i.test(p)}if(!u(navigator.userAgent))return;let a;if(a=t,["INPUT","SELECT","BUTTON","TEXTAREA"].includes(a.tagName)||(a=a.querySelector('input:not([type="hidden"]):not(.flatpickr-input), select, textarea')),a)try{a.focus({preventScroll:!0}),i.selectErrorText&&a.tagName=="INPUT"&&a.select()}catch{}},gt={trueStringValue:"true",dateFormat:"iso"};function Er(r,i,s){return ht(r,i,"number",{...gt,...s})}function Tr(r,i,s){return ht(r,i,"date",{...gt,dateFormat:(s==null?void 0:s.format)??"iso",empty:s==null?void 0:s.empty})}function _r(r,i,s){const t=Z(r,i,s),l=q(new DataTransfer().files);let u=!1,a;return t.subscribe(y=>{u||(a=y,u=!0);const c=new DataTransfer;y instanceof File&&c.items.add(y),l.set(c.files)}),{subscribe(y){return l.subscribe(y)},set(y){if(y)if(y instanceof File){const c=new DataTransfer;c.items.add(y),l.set(c.files),t.set(y)}else y instanceof FileList&&(l.set(y),y.length>0?t.set(y.item(0)):t.set(a));else{const c=new DataTransfer;l.set(c.files),t.set(y)}},update(){throw new F("You cannot update a fileProxy, only set it.")}}}function ht(r,i,s,t){function l(m){if(!m&&t.empty!==void 0)return t.empty==="null"?null:t.empty==="zero"?0:void 0;typeof m=="number"&&(m=m.toString()),typeof m!="string"&&(m="");const f=m;if(s=="string")return f;if(s=="boolean")return!!f;if(s=="date")return new Date(f);const _=t.delimiter?f.replace(t.delimiter,"."):f;let T;return _===""&&t.empty=="zero"?T=0:s=="number"?T=parseFloat(_):T=parseInt(_,10),T}const u=bt(r,t),a=u?Te(r,i,{taint:t.taint}):Z(r,i);let p=null,y=!1;return{subscribe:de(a,m=>{if(!y&&(y=!0,t.initiallyEmptyIfZero&&!m))return"";if(p!==null){const f=p;return p=null,f}if(m==null)return"";if(s=="string")return m;if(s=="int"||s=="number")return m===""&&a.set(0,u?{taint:!1}:void 0),typeof m=="number"&&isNaN(m)?"":String(m);if(s=="date"){const f=m;if(isNaN(f))return"";switch(t.dateFormat){case"iso":return f.toISOString();case"date":return f.toISOString().slice(0,10);case"datetime":return f.toISOString().slice(0,16);case"time":return f.toISOString().slice(11,16);case"date-utc":return ut(f);case"datetime-utc":return ut(f)+"T"+lt(f);case"time-utc":return lt(f);case"date-local":return at(f);case"datetime-local":return at(f)+"T"+ot(f);case"time-local":return ot(f)}}else return m?t.trueStringValue:""}).subscribe,set(m){p=m;const f=l(p);a.set(f)},update(m){a.update(f=>(p=m(String(f)),l(p)))}}}function Ar(r,i,s){const t=Z(r.errors,`${i}`),l=de(t,c=>{const m=[];for(const f in c)f!="_errors"&&(m[f]=c[f]);return m});function u(c,m){for(const f in c)f!="_errors"&&(c[f]=void 0);if(m!==void 0)for(const f in m)c[f]=m[f];return c}const a={subscribe:l.subscribe,update(c){t.update(m=>u(m,c(m)))},set(c){t.update(m=>u(m,c))}},p=Te(r,i,s);let y=Array.isArray(ae(p))?ae(p).length:0;return p.subscribe(c=>{const m=Array.isArray(c)?c.length:0;m<y&&r.errors.update(f=>{const _=Q(f,ne(i));if(!_)return f;for(const T in _.value)Number(T)<m||delete _.value[T];return f},{force:!0}),y=m}),{path:i,values:p,errors:Z(r.errors,`${i}._errors`),valueErrors:a}}function Mr(r,i,s){const t=ne(i),l=t.filter(p=>/\D/.test(String(p))).join("."),a={subscribe:de(r.tainted,p=>{if(!p)return p;const y=L(p,t);return y?y.value:void 0}).subscribe,update(p){r.tainted.update(y=>{y||(y={});const c=L(y,t,m=>(m.value||(m.parent[m.key]={}),m.parent[m.key]));return c&&(c.parent[c.key]=p(c.value)),y})},set(p){r.tainted.update(y=>{y||(y={});const c=L(y,t,m=>(m.value||(m.parent[m.key]={}),m.parent[m.key]));return c&&(c.parent[c.key]=p),y})}};return{path:i,value:Te(r,i,s),errors:Z(r.errors,i),constraints:Z(r.constraints,l),tainted:a}}function Ee(r,i,s){const t=L(r,i,({parent:l,key:u,value:a})=>(a===void 0&&(l[u]=/\D/.test(u)?{}:[]),l[u]));if(t){const l=s(t.value);t.parent[t.key]=l}return r}function Te(r,i,s){const t=r.form,l=ne(i),u=de(t,a=>{const p=L(a,l);return p==null?void 0:p.value});return{subscribe(...a){const p=u.subscribe(...a);return()=>p()},update(a,p){t.update(y=>Ee(y,l,a),p??s)},set(a,p){t.update(y=>Ee(y,l,()=>a),p??s)}}}function bt(r,i){const s="form"in r;if(!s&&(i==null?void 0:i.taint)!==void 0)throw new F("If options.taint is set, the whole superForm object must be used as a proxy.");return s}function Z(r,i,s){const t=ne(i);if(bt(r,s))return Te(r,i,s);const l=de(r,u=>{const a=L(u,t);return a==null?void 0:a.value});return{subscribe(...u){const a=l.subscribe(...u);return()=>a()},update(u){r.update(a=>Ee(a,t,u))},set(u){r.update(a=>Ee(a,t,()=>u))}}}function at(r){return r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")}function ot(r){return String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")}function ut(r){return r.getUTCFullYear()+"-"+String(r.getUTCMonth()+1).padStart(2,"0")+"-"+String(r.getUTCDate()).padStart(2,"0")}function lt(r){return String(r.getUTCHours()).padStart(2,"0")+":"+String(r.getUTCMinutes()).padStart(2,"0")}function Ve(r){let i={};const s=Array.isArray(r);for(const[t,l]of Object.entries(r))!l||typeof l!="object"||(s?i={...i,...Ve(l)}:i[t]=Ve(l));return i}const Se=new WeakMap,le=new WeakMap,vt=r=>{console.warn("Unhandled error caught by Superforms, use onError event to handle it:",r.result.error)},cr={applyAction:!0,invalidateAll:!0,resetForm:!0,autoFocusOnError:"detect",scrollToError:"smooth",errorSelector:'[aria-invalid="true"],[data-invalid]',selectErrorText:!1,stickyNavbar:void 0,taintedMessage:!1,onSubmit:void 0,onResult:void 0,onUpdate:void 0,onUpdated:void 0,onError:vt,dataType:"form",validators:void 0,customValidity:!1,clearOnSubmit:"message",delayMs:500,timeoutMs:8e3,multipleSubmits:"prevent",SPA:void 0,validationMethod:"auto"};function fr(r){return`Duplicate form id's found: "${r}". Multiple forms will receive the same data. Use the id option to differentiate between them, or if this is intended, set the warnings.duplicateId option to false in superForm to disable this warning. More information: https://superforms.rocks/concepts/multiple-forms`}let St=!1;try{St=!0}catch{}let ce=!1;try{globalThis.STORIES&&(ce=!0)}catch{}function dr(r,i){var Ze;let s,t=i??{},l;{if((t.legacy??St)&&(t.resetForm===void 0&&(t.resetForm=!1),t.taintedMessage===void 0&&(t.taintedMessage=!0)),ce&&t.applyAction===void 0&&(t.applyAction=!1),typeof t.SPA=="string"&&(t.invalidateAll===void 0&&(t.invalidateAll=!1),t.applyAction===void 0&&(t.applyAction=!1)),l=t.validators,t={...cr,...t},(t.SPA===!0||typeof t.SPA=="object")&&t.validators===void 0&&console.warn("No validators set for superForm in SPA mode. Add a validation adapter to the validators option, or set it to false to disable this warning."),!r)throw new F("No form data sent to superForm. Make sure the output from superValidate is used (usually data.form) and that it's not null or undefined. Alternatively, an object with default values for the form can also be used, but then constraints won't be available.");c(r)===!1&&(r={id:t.id??Math.random().toString(36).slice(2,10),valid:!1,posted:!1,errors:{},data:r,shape:Ve(r)}),r=r;const e=r.id=t.id??r.id,n=ae(pe)??(ce?{}:void 0);if(((Ze=t.warnings)==null?void 0:Ze.duplicateId)!==!1)if(!Se.has(n))Se.set(n,new Set([e]));else{const o=Se.get(n);o!=null&&o.has(e)?console.warn(fr(e)):o==null||o.add(e)}if(le.has(r)||le.set(r,r),s=le.get(r),r=V(s),we(()=>{var o;Ot(),At(),Nt();for(const d of Object.values($))d.length=0;(o=Se.get(n))==null||o.delete(e)}),t.dataType!=="json"){const o=(d,g)=>{if(!(!g||typeof g!="object")){if(Array.isArray(g))g.length>0&&o(d,g[0]);else if(!(g instanceof Date)&&!(g instanceof File)&&!(g instanceof FileList))throw new F(`Object found in form field "${d}". Set the dataType option to "json" and add use:enhance to use nested data structures. More information: https://superforms.rocks/concepts/nested-data`)}};for(const[d,g]of Object.entries(r.data))o(d,g)}}const u={formId:r.id,form:V(r.data),constraints:r.constraints??{},posted:r.posted,errors:V(r.errors),message:V(r.message),tainted:void 0,valid:r.valid,submitting:!1,shape:r.shape},a=u,p=q(t.id??r.id);function y(e){return Object.values(e).filter(o=>c(o)!==!1)}function c(e){return!e||typeof e!="object"||!("valid"in e&&"errors"in e&&typeof e.valid=="boolean")?!1:"id"in e&&typeof e.id=="string"?e.id:!1}const m=q(r.data),f={subscribe:m.subscribe,set:(e,n={})=>{const o=V(e);return Be(o,n.taint??!0),m.set(o)},update:(e,n={})=>m.update(o=>{const d=e(o);return Be(d,n.taint??!0),d})};function _(){return t.SPA===!0||typeof t.SPA=="object"}async function T(e={}){const n=e.formData??a.form;let o={},d;const g=e.adapter??t.validators;if(typeof g=="object"){if(g!=l&&!("jsonSchema"in g))throw new F('Client validation adapter found in options.validators. A full adapter must be used when changing validators dynamically, for example "zod" instead of "zodClient".');if(d=await g.validate(n),!d.success)o=rr(d.issues,g.shape??a.shape??{});else if(e.recheckValidData!==!1)return T({...e,recheckValidData:!1})}else d={success:!0,data:{}};const b={...a.form,...n,...d.success?d.data:{}};return{valid:d.success,posted:!1,errors:o,data:b,constraints:a.constraints,message:void 0,id:a.formId,shape:a.shape}}function J(e){if(!t.onChange||!e.paths.length||e.type=="blur")return;let n;const o=e.paths.map(ge);e.type&&e.paths.length==1&&e.formElement&&e.target instanceof Element?n={path:o[0],paths:o,formElement:e.formElement,target:e.target,set(d,g,b){Z({form:f},d,b).set(g)},get(d){return ae(Z(f,d))}}:n={paths:o,target:void 0,set(d,g,b){Z({form:f},d,b).set(g)},get(d){return ae(Z(f,d))}},t.onChange(n)}async function K(e,n=!1,o){e&&(t.validators=="clear"&&H.update(b=>(G(b,e.paths,void 0),b)),setTimeout(()=>J(e)));let d=!1;if(n||(t.validationMethod=="onsubmit"||t.validationMethod=="submit-only"||t.validationMethod=="onblur"&&(e==null?void 0:e.type)=="input"||t.validationMethod=="oninput"&&(e==null?void 0:e.type)=="blur")&&(d=!0),d||!e||!t.validators||t.validators=="clear"){if(e!=null&&e.paths){const b=(e==null?void 0:e.formElement)??me();b&&S(b)}return}const g=await T({adapter:o});return g.valid&&(e.immediate||e.type!="input")&&f.set(g.data,{taint:"ignore"}),await je(),U(g.errors,e,n),g}function S(e){const n=new Map;if(t.customValidity&&e)for(const o of e.querySelectorAll("[name]")){if(typeof o.name!="string"||!o.name.length)continue;const d="validationMessage"in o?String(o.validationMessage):"";n.set(o.name,{el:o,message:d}),it(o,void 0)}return n}async function U(e,n,o){const{type:d,immediate:g,multiple:b,paths:N}=n,te=a.errors,C={};let I=new Map;const X=n.formElement??me();X&&(I=S(X)),ee(e,E=>{if(!Array.isArray(E.value))return;const B=[...E.path];B[B.length-1]=="_errors"&&B.pop();const z=B.join(".");function Y(){if(G(C,[E.path],E.value),t.customValidity&&ue&&I.has(z)){const{el:h,message:v}=I.get(z);v!=E.value&&(setTimeout(()=>it(h,E.value)),I.clear())}}if(o)return Y();const ie=E.path[E.path.length-1]=="_errors",ue=E.value&&N.some(h=>ie?B&&h&&B.length>0&&B[0]==h[0]:z==h.join("."));if(ue&&t.validationMethod=="oninput"||g&&!b&&ue)return Y();if(b){const h=Q(ae(H),E.path.slice(0,-1));if(h!=null&&h.value&&typeof(h==null?void 0:h.value)=="object"){for(const v of Object.values(h.value))if(Array.isArray(v))return Y()}}const se=Q(te,E.path);if(se&&se.key in se.parent)return Y();if(ie){if(t.validationMethod=="oninput"||d=="blur"&&It(ge(E.path.slice(0,-1))))return Y()}else if(d=="blur"&&ue)return Y()}),H.set(C)}function wt(e,n={}){return n.keepFiles&&ee(a.form,o=>{if(!(o.parent instanceof FileList)&&(o.value instanceof File||o.value instanceof FileList)){const d=Q(e,o.path);(!d||!(d.key in d.parent))&&G(e,[o.path],o.value)}}),f.set(e,n)}function he(e,n){return e&&n&&t.resetForm&&(t.resetForm===!0||t.resetForm())}async function Re(e,n){e.valid&&n&&he(e.valid,n)?_e({message:e.message,posted:!0}):ve({form:e,untaint:n,keepFiles:!0,skipFormData:t.invalidateAll=="force"}),$.onUpdated.length&&await je();for(const o of $.onUpdated)o({form:e})}function _e(e={}){e.newState&&(s.data={...s.data,...e.newState});const n=V(s);n.data={...n.data,...e.data},e.id!==void 0&&(n.id=e.id),ve({form:n,untaint:!0,message:e.message,keepFiles:!1,posted:e.posted,resetted:!0})}async function Et(e){if(e.type=="error")throw new F(`ActionResult of type "${e.type}" cannot be passed to update function.`);if(e.type=="redirect"){he(!0,!0)&&_e({posted:!0});return}if(typeof e.data!="object")throw new F("Non-object validation data returned from ActionResult.");const n=y(e.data);if(!n.length)throw new F("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const o of n)o.id===a.formId&&await Re(o,e.status>=200&&e.status<300)}const oe=q(u.message),Ae=q(u.constraints),Me=q(u.posted),Le=q(u.shape),ke=q(r.errors),H={subscribe:ke.subscribe,set(e,n){return ke.set(rt(e,a.errors,n==null?void 0:n.force))},update(e,n){return ke.update(o=>rt(e(o),a.errors,n==null?void 0:n.force))},clear:()=>H.set({})};let M=null;function Tt(e){var n;M&&e&&Object.keys(e).length==1&&((n=e.paths)!=null&&n.length)&&M.target&&M.target instanceof HTMLInputElement&&M.target.type.toLowerCase()=="file"?M.paths=e.paths:M=e,setTimeout(()=>{K(M)},0)}function _t(e,n,o,d,g){M===null&&(M={paths:[]}),M.type=e,M.immediate=n,M.multiple=o,M.formElement=d,M.target=g}function Ue(){return(M==null?void 0:M.paths)??[]}function At(){M=null}const P={defaultMessage:"Leave page? Changes that you made may not be saved.",state:q(),message:t.taintedMessage,clean:V(r.data),forceRedirection:!1};function He(){return t.taintedMessage&&!a.submitting&&!P.forceRedirection&&qe()}function $e(e){if(!He())return;e.preventDefault(),e.returnValue="";const{taintedMessage:n}=t,d=typeof n=="function"||n===!0?P.defaultMessage:n;return(e||window.event).returnValue=d||P.defaultMessage,d}async function Mt(e){if(!He())return;const{taintedMessage:n}=t,o=typeof n=="function";if(o&&e.cancel(),e.type==="leave")return;const d=o||n===!0?P.defaultMessage:n;let g;try{g=o?await n():window.confirm(d||P.defaultMessage)}catch{g=!1}if(g&&e.to)try{P.forceRedirection=!0,await zt(e.to.url,{...e.to.params});return}finally{P.forceRedirection=!1}else!g&&!o&&e.cancel()}function kt(){t.taintedMessage=P.message}function Ft(){return P.state}function It(e){if(!a.tainted)return!1;if(!e)return!!a.tainted;const n=Q(a.tainted,ne(e));return!!n&&n.key in n.parent}function qe(e){if(!arguments.length)return be(a.tainted);if(typeof e=="boolean")return e;if(typeof e=="object")return be(e);if(!a.tainted||e===void 0)return!1;const n=Q(a.tainted,ne(e));return be(n==null?void 0:n.value)}function be(e){if(!e)return!1;if(typeof e=="object"){for(const n of Object.values(e))if(be(n))return!0}return e===!0}function Be(e,n){if(n=="ignore")return;const o=tt(e,a.form),d=tt(e,P.clean).map(g=>g.join());o.length&&(n=="untaint-all"||n=="untaint-form"?P.state.set(void 0):P.state.update(g=>(g||(g={}),G(g,o,(b,N)=>{if(!d.includes(b.join()))return;const te=L(e,b),C=L(P.clean,b);return te&&C&&te.value===C.value?void 0:n===!0?!0:n==="untaint"?void 0:N.value}),g))),Tt({paths:o})}function Pt(e,n){P.state.set(e),n&&(P.clean=n)}const Fe=q(!1),ze=q(!1),Ye=q(!1),We=[P.state.subscribe(e=>u.tainted=V(e)),f.subscribe(e=>u.form=V(e)),H.subscribe(e=>u.errors=V(e)),p.subscribe(e=>u.formId=e),Ae.subscribe(e=>u.constraints=e),Me.subscribe(e=>u.posted=e),oe.subscribe(e=>u.message=e),Fe.subscribe(e=>u.submitting=e),Le.subscribe(e=>u.shape=e)];function Dt(e){We.push(e)}function Ot(){We.forEach(e=>e())}let x;function me(){return x}function jt(e){x=document.createElement("form"),x.method="POST",x.action=e,Ge(x),document.body.appendChild(x)}function xt(e){x&&(x.action=e)}function Nt(){x!=null&&x.parentElement&&x.remove(),x=void 0}const Ct=de(H,e=>e?nr(e):[]);t.taintedMessage=void 0;function ve(e){const n=e.form,o=e.message??n.message;if((e.untaint||e.resetted)&&Pt(typeof e.untaint=="boolean"?void 0:e.untaint,n.data),e.skipFormData!==!0&&wt(n.data,{taint:"ignore",keepFiles:e.keepFiles}),oe.set(o),e.resetted?H.update(()=>({}),{force:!0}):H.set(n.errors),p.set(n.id),Me.set(e.posted??n.posted),n.constraints&&Ae.set(n.constraints),n.shape&&Le.set(n.shape),u.valid=n.valid,t.flashMessage&&Ne(t)){const d=t.flashMessage.module.getFlash(pe);o&&ae(d)===void 0&&d.set(o)}}const $={onSubmit:t.onSubmit?[t.onSubmit]:[],onResult:t.onResult?[t.onResult]:[],onUpdate:t.onUpdate?[t.onUpdate]:[],onUpdated:t.onUpdated?[t.onUpdated]:[],onError:t.onError?[t.onError]:[]};window.addEventListener("beforeunload",$e),we(()=>{window.removeEventListener("beforeunload",$e)}),qt(Mt),Dt(pe.subscribe(async e=>{ce&&e===void 0&&(e={status:200});const n=e.status>=200&&e.status<300;if(t.applyAction&&e.form&&typeof e.form=="object"){const o=e.form;if(o.type=="error")return;for(const d of y(o)){const g=le.has(d);d.id!==a.formId||g||(le.set(d,d),await Re(d,n))}}else if(e.data&&typeof e.data=="object")for(const o of y(e.data)){const d=le.has(o);if(o.id!==a.formId||d)continue;t.invalidateAll==="force"&&(s.data=o.data);const g=he(!0,!0);ve({form:o,untaint:n,keepFiles:!g,resetted:g})}})),typeof t.SPA=="string"&&jt(t.SPA);function Ge(e,n){if(t.SPA!==void 0&&e.method=="get"&&(e.method="post"),typeof t.SPA=="string"?t.SPA.length&&e.action==document.location.href&&(e.action=t.SPA):x=e,n){if(n.onError){if(t.onError==="apply")throw new F('options.onError is set to "apply", cannot add any onError events.');if(n.onError==="apply")throw new F('Cannot add "apply" as onError event in use:enhance.');$.onError.push(n.onError)}n.onResult&&$.onResult.push(n.onResult),n.onSubmit&&$.onSubmit.push(n.onSubmit),n.onUpdate&&$.onUpdate.push(n.onUpdate),n.onUpdated&&$.onUpdated.push(n.onUpdated)}kt();let o;async function d(C){const I=st(C.target);I.immediate&&!I.file&&await new Promise(X=>setTimeout(X,0)),o=Ue(),_t("input",I.immediate,I.multiple,e,C.target??void 0)}async function g(C){if(a.submitting||!o||Ue()!=o)return;const I=st(C.target);I.immediate&&!I.file&&await new Promise(X=>setTimeout(X,0)),K({paths:o,immediate:I.multiple,multiple:I.multiple,type:"blur",formElement:e,target:C.target??void 0}),o=void 0}e.addEventListener("focusout",g),e.addEventListener("input",d),we(()=>{e.removeEventListener("focusout",g),e.removeEventListener("input",d)});const b=lr(e,{submitting:Fe,delayed:ze,timeout:Ye},t);let N,te;return Yt(e,async C=>{let I,X=t.validators;const E={...C,jsonData(h){if(t.dataType!=="json")throw new F("options.dataType must be set to 'json' to use jsonData.");I=h},validators(h){X=h},customRequest(h){te=h}},B=E.cancel;let z=!1;function Y(h){var W;const v={...h,posted:!0},w=v.valid?200:(typeof t.SPA=="boolean"||typeof t.SPA=="string"||(W=t.SPA)==null?void 0:W.failStatus)??400,D={form:v},j=v.valid?{type:"success",status:w,data:D}:{type:"failure",status:w,data:D};setTimeout(()=>se({result:j}),0)}function Je(){switch(t.clearOnSubmit){case"errors-and-message":H.clear(),oe.set(void 0);break;case"errors":H.clear();break;case"message":oe.set(void 0);break}}function ie(h={resetTimers:!0}){return z=!0,h.resetTimers&&b.isSubmitting()&&b.completed({cancelled:z}),B()}if(E.cancel=ie,b.isSubmitting()&&t.multipleSubmits=="prevent")ie({resetTimers:!1});else{b.isSubmitting()&&t.multipleSubmits=="abort"&&N&&N.abort(),b.submitting(),N=E.controller;for(const h of $.onSubmit)await h(E)}if(z&&t.flashMessage&&nt(t),!z){const h=!_()&&(e.noValidate||(E.submitter instanceof HTMLButtonElement||E.submitter instanceof HTMLInputElement)&&E.submitter.formNoValidate);let v;const w=async()=>await T({adapter:X});if(Je(),h||(v=await w(),v.valid||(ie({resetTimers:!1}),Y(v))),!z){t.flashMessage&&(t.clearOnSubmit=="errors-and-message"||t.clearOnSubmit=="message")&&Ne(t)&&t.flashMessage.module.getFlash(pe).set(void 0);const D="formData"in E?E.formData:E.data;if(o=void 0,_())v||(v=await w()),ie({resetTimers:!1}),Y(v);else if(t.dataType==="json"){v||(v=await w());const j=V(I??v.data);ee(j,k=>{if(k.value instanceof File){const A="__superform_file_"+ge(k.path);return D.append(A,k.value),k.set(void 0)}else if(Array.isArray(k.value)&&k.value.length&&k.value.every(A=>A instanceof File)){const A="__superform_files_"+ge(k.path);for(const R of k.value)D.append(A,R);return k.set(void 0)}}),Object.keys(j).forEach(k=>{typeof D.get(k)=="string"&&D.delete(k)});const W=ue(Kt(j),t.jsonChunkSize??5e5);for(const k of W)D.append("__superform_json",k)}if(!D.has("__superform_id")){const j=a.formId;j!==void 0&&D.set("__superform_id",j)}typeof t.SPA=="string"&&xt(t.SPA)}}function ue(h,v){const w=Math.ceil(h.length/v),D=new Array(w);for(let j=0,W=0;j<w;++j,W+=v)D[j]=h.substring(W,W+v);return D}async function se(h){var k;let v=!1;N=null;let w="type"in h.result&&"status"in h.result?h.result:{type:"error",status:parseInt(String(h.result.status))||500,error:h.result.error instanceof Error?h.result.error:h.result};const D=()=>v=!0,j={result:w,formEl:e,formElement:e,cancel:D},W=ce||!_()?()=>{}:Ke.subscribe(A=>{var R,re;!A||((R=A.from)==null?void 0:R.route.id)===((re=A.to)==null?void 0:re.route.id)||D()});for(const A of $.onResult)await A(j);if(w=j.result,!v){if((w.type==="success"||w.type=="failure")&&w.data){const A=y(w.data);if(!A.length)throw new F("No form data returned from ActionResult. Make sure you return { form } in the form actions.");for(const R of A){if(R.id!==a.formId)continue;const re={form:R,formEl:e,formElement:e,cancel:()=>v=!0,result:w};for(const Ie of $.onUpdate)await Ie(re);w=re.result,v||(t.customValidity&&ir(e,re.form.errors),he(re.form.valid,w.type=="success")&&re.formElement.querySelectorAll('input[type="file"]').forEach(Ie=>Ie.value=""))}}if(!v){if(w.type!=="error")w.type==="success"&&t.invalidateAll&&await Bt(),t.applyAction?await De(w):await Et(w);else{if(t.applyAction)if(t.onError=="apply")await De(w);else{const A={type:"failure",status:Math.floor(w.status||500),data:w};await De(A)}if(t.onError!=="apply"){const A={result:w,message:oe};for(const R of $.onError)R!=="apply"&&(R!=vt||!((k=t.flashMessage)!=null&&k.onError))&&await R(A)}}t.flashMessage&&w.type=="error"&&t.flashMessage.onError&&await t.flashMessage.onError({result:w,flashMessage:t.flashMessage.module.getFlash(pe)})}}if(v&&t.flashMessage&&nt(t),v||w.type!="redirect")b.completed({cancelled:v});else if(ce)b.completed({cancelled:v,clearAll:!0});else{const A=Ke.subscribe(R=>{R||(setTimeout(()=>{try{A&&A()}catch{}}),b.isSubmitting()&&b.completed({cancelled:v,clearAll:!0}))})}W()}if(te){z||B();const h=await te(C),v=h instanceof Response?Xe(await h.text()):Xe(h.responseText);v.type==="error"&&(v.status=h.status),se({result:v})}return se})}function Vt(e){const n=[];if(ee(e,d=>{if(d.value instanceof File)return n.push(d.path),"skip";if(Array.isArray(d.value)&&d.value.length&&d.value.every(g=>g instanceof File))return n.push(d.path),"skip"}),!n.length)return{data:e,paths:n};const o=V(e);return G(o,n,d=>{var g;return(g=Q(s.data,d))==null?void 0:g.value}),{data:o,paths:n}}return{form:f,formId:p,errors:H,message:oe,constraints:Ae,tainted:Ft(),submitting:Pe(Fe),delayed:Pe(ze),timeout:Pe(Ye),options:t,capture(){const{data:e,paths:n}=Vt(a.form);let o=a.tainted;return n.length&&(o=V(o)??{},G(o,n,!1)),{valid:a.valid,posted:a.posted,errors:a.errors,data:e,constraints:a.constraints,message:a.message,id:a.formId,tainted:o,shape:a.shape}},restore:e=>{ve({form:e,untaint:e.tainted??!0})},async validate(e,n={}){if(!t.validators)throw new F("options.validators must be set to use the validate method.");n.update===void 0&&(n.update=!0),n.taint===void 0&&(n.taint=!1),typeof n.errors=="string"&&(n.errors=[n.errors]);let o;const d=ne(e);"value"in n?n.update===!0||n.update==="value"?(f.update(N=>(G(N,[d],n.value),N),{taint:n.taint}),o=a.form):(o=V(a.form),G(o,[d],n.value)):o=a.form;const g=await T({formData:o}),b=Q(g.errors,d);return b&&b.value&&n.errors&&(b.value=n.errors),(n.update===!0||n.update=="errors")&&H.update(N=>(G(N,[d],b==null?void 0:b.value),N)),b==null?void 0:b.value},async validateForm(e={}){if(!t.validators&&!e.schema)throw new F("options.validators or the schema option must be set to use the validateForm method.");const n=e.update?await K({paths:[]},!0,e.schema):T({adapter:e.schema}),o=me();return e.update&&o&&setTimeout(()=>{o&&Ce(o,{...t,scrollToError:e.focusOnError===!1?"off":t.scrollToError})},1),n||T({adapter:e.schema})},allErrors:Ct,posted:Me,reset(e){return _e({message:e!=null&&e.keepMessage?a.message:void 0,data:e==null?void 0:e.data,id:e==null?void 0:e.id,newState:e==null?void 0:e.newState})},submit(e){const n=me()?me():e&&e instanceof HTMLElement?e.closest("form"):void 0;if(!n)throw new F("use:enhance must be added to the form to use submit, or pass a HTMLElement inside the form (or the form itself) as an argument.");if(!n.requestSubmit)return n.submit();const o=e&&(e instanceof HTMLButtonElement&&e.type=="submit"||e instanceof HTMLInputElement&&["submit","image"].includes(e.type));n.requestSubmit(o?e:void 0)},isTainted:qe,enhance:Ge}}let mr=!1;try{mr=!0}catch{}function kr(...r){return dr(r[0],{onError:i=>{Rt(i.result.error.message,"error")},...r[1]})}export{_r as a,Ar as b,Z as c,Tr as d,Mr as f,Er as n,kr as s};
