{"version":3,"file":"actions3-ByPkkF84.js","sources":["../../../.svelte-kit/adapter-node/chunks/actions3.js"],"sourcesContent":["import { hg as tickets_errors_ticketNotFound, hP as tickets_addToCart_errors_notAllowed, hQ as tickets_addToCart_errors_salePeriodEnded, hR as tickets_addToCart_errors_salePeriodNotStarted, hS as tickets_addToCart_errors_ticketSoldOut, hT as tickets_addToCart_errors_alreadyOwned, hU as tickets_addToCart_errors_alreadyOwnsMax, hV as tickets_addToCart_errors_alreadyReserved, hW as tickets_addToCart_addedToInventory, hX as tickets_addToCart_unknownResult, hY as tickets_addToCart_inQueue, hZ as tickets_addToCart_lotteryReservation, h_ as tickets_addToCart_addedToCart } from \"./messages.js\";\nimport { a as authorizedPrismaClient } from \"./authorizedPrisma.js\";\nimport { d as dbIdentification, G as GRACE_PERIOD_WINDOW, T as TIME_TO_BUY } from \"./types4.js\";\nimport { e as ensureState, s as sendQueuedNotifications, q as queueNextExpiredConsumablesPruning, p as performLotteryIfNecessary } from \"./reservations.js\";\nimport { error } from \"console\";\nimport { a as apiNames } from \"./apiNames.js\";\nimport { a as authorize } from \"./authorization.js\";\nimport { r as redirect } from \"./redirect.js\";\nimport \"./client.js\";\nimport \"just-clone\";\nimport \"ts-deepmerge\";\nimport \"./superForm.js\";\nimport \"./index.js\";\nimport \"devalue\";\nimport { s as superValidate, f as fail, m as message } from \"./superValidate.js\";\nimport \"memoize-weak\";\nimport { z as zod } from \"./zod.js\";\nimport { z } from \"zod\";\nvar AddToCartStatus = /* @__PURE__ */ ((AddToCartStatus2) => {\n  AddToCartStatus2[\"AddedToCart\"] = \"AddedToCart\";\n  AddToCartStatus2[\"Reserved\"] = \"Reserved\";\n  AddToCartStatus2[\"PutInQueue\"] = \"PutInQueue\";\n  AddToCartStatus2[\"AddedToInventory\"] = \"AddedToInventory\";\n  return AddToCartStatus2;\n})(AddToCartStatus || {});\nconst addTicketToCart = async (prisma, ticketId, user) => {\n  const now = /* @__PURE__ */ new Date();\n  const queuedNotifications = [];\n  if (!user.memberId && !user.externalCode) {\n    throw error(401);\n  }\n  const idPart = dbIdentification(\n    user.memberId ? {\n      memberId: user.memberId\n    } : {\n      externalCode: user.externalCode\n    }\n  );\n  await authorizedPrismaClient.$transaction(async (prisma2) => {\n    const result = await ensureState(prisma2, now, ticketId);\n    queuedNotifications.push(...result.queuedNotifications);\n  });\n  sendQueuedNotifications(queuedNotifications);\n  const res = await prisma.$transaction(async (tx) => {\n    const ticket = await tx.ticket.findUnique({\n      where: {\n        id: ticketId,\n        shoppable: {\n          // not removed\n          OR: [\n            {\n              removedAt: null\n            },\n            {\n              removedAt: {\n                gt: /* @__PURE__ */ new Date()\n              }\n            }\n          ]\n        }\n      },\n      include: {\n        shoppable: {\n          include: {\n            accessPolicies: true,\n            consumables: true,\n            _count: {\n              select: {\n                consumables: {\n                  where: {\n                    purchasedAt: {\n                      not: null\n                    }\n                  }\n                },\n                reservations: true\n              }\n            }\n          }\n        }\n      }\n    });\n    if (!ticket) throw new Error(tickets_errors_ticketNotFound());\n    if (ticket.shoppable.accessPolicies.length > 0 && !ticket.shoppable.accessPolicies.some(\n      (p) => p.role && user.roles.includes(p.role) || p.studentId && p.studentId === user.studentId\n    )) {\n      throw new Error(tickets_addToCart_errors_notAllowed());\n    }\n    if (ticket.shoppable.availableTo && ticket.shoppable.availableTo < now)\n      throw new Error(tickets_addToCart_errors_salePeriodEnded());\n    if (ticket.shoppable.availableFrom > now)\n      throw new Error(tickets_addToCart_errors_salePeriodNotStarted());\n    if (ticket.shoppable._count.consumables >= ticket.stock)\n      throw new Error(tickets_addToCart_errors_ticketSoldOut());\n    await checkUserMaxAmount(tx, idPart, ticket);\n    if (now.valueOf() - ticket.shoppable.availableFrom.valueOf() < GRACE_PERIOD_WINDOW) {\n      return await addReservationInReserveWindow(\n        tx,\n        idPart,\n        ticket.shoppable.id,\n        ticket.shoppable.availableFrom.valueOf() + GRACE_PERIOD_WINDOW - now.valueOf()\n      );\n    }\n    if (ticket.shoppable.consumables.length >= ticket.stock) {\n      return addToQueue(tx, idPart, ticket);\n    }\n    if (ticket.shoppable.price === 0) {\n      await tx.consumable.create({\n        data: {\n          ...idPart,\n          shoppableId: ticket.shoppable.id,\n          purchasedAt: now,\n          priceAtPurchase: 0\n        }\n      });\n      return {\n        status: \"AddedToInventory\"\n        /* AddedToInventory */\n      };\n    }\n    await tx.consumable.create({\n      data: {\n        ...idPart,\n        shoppableId: ticket.shoppable.id,\n        expiresAt: new Date(now.valueOf() + TIME_TO_BUY)\n      }\n    });\n    return {\n      status: \"AddedToCart\"\n      /* AddedToCart */\n    };\n  });\n  await queueNextExpiredConsumablesPruning();\n  return res;\n};\nconst checkUserMaxAmount = async (prisma, id, ticket) => {\n  const currentlyInCart = await prisma.consumable.count({\n    where: {\n      ...id,\n      shoppableId: ticket.shoppable.id\n    }\n  });\n  if (ticket.maxAmountPerUser == 1 && currentlyInCart > 0)\n    throw new Error(tickets_addToCart_errors_alreadyOwned());\n  else if (currentlyInCart >= ticket.maxAmountPerUser)\n    throw new Error(tickets_addToCart_errors_alreadyOwnsMax());\n  const currentlyReserved = await prisma.consumableReservation.count({\n    where: {\n      ...id,\n      shoppableId: ticket.shoppable.id\n    }\n  });\n  if (currentlyReserved > 0)\n    throw new Error(tickets_addToCart_errors_alreadyReserved());\n};\nconst addToQueue = async (prisma, id, ticket) => {\n  const currentPeopleInQueue = await prisma.consumableReservation.findMany({\n    where: {\n      shoppableId: ticket.shoppable.id\n    },\n    orderBy: {\n      order: \"desc\"\n    }\n  });\n  const lastInQueueOrder = currentPeopleInQueue[0]?.order ?? -1;\n  await prisma.consumableReservation.create({\n    data: {\n      ...id,\n      shoppableId: ticket.shoppable.id,\n      order: lastInQueueOrder + 1\n    }\n  });\n  return {\n    status: \"PutInQueue\",\n    queuePosition: lastInQueueOrder + 2\n  };\n};\nconst afterGracePeriod = async (shoppableId) => {\n  try {\n    const queuedNotifications = await authorizedPrismaClient.$transaction(\n      async (prisma) => {\n        return await performLotteryIfNecessary(prisma, /* @__PURE__ */ new Date(), shoppableId);\n      }\n    );\n    sendQueuedNotifications(queuedNotifications);\n  } catch (err) {\n    console.error(\"problem performing reservation lottery:\", err);\n  }\n};\nconst gracePeriodTimeouts = {};\nconst addReservationInReserveWindow = async (prisma, id, shoppableId, timeUntilGracePeriod) => {\n  const existingReservation = await prisma.consumableReservation.findFirst({\n    where: {\n      ...id,\n      shoppableId\n    }\n  });\n  if (existingReservation)\n    throw new Error(tickets_addToCart_errors_alreadyReserved());\n  await prisma.consumableReservation.create({\n    data: {\n      ...id,\n      shoppableId,\n      order: null\n    }\n  });\n  if (gracePeriodTimeouts[shoppableId] === void 0) {\n    gracePeriodTimeouts[shoppableId] = setTimeout(() => {\n      afterGracePeriod(shoppableId);\n      delete gracePeriodTimeouts[shoppableId];\n    }, timeUntilGracePeriod);\n  }\n  return {\n    status: \"Reserved\"\n    /* Reserved */\n  };\n};\nconst addToCartSchema = z.object({\n  ticketId: z.string().uuid()\n});\nconst ticketPageActions = (prefix = \"/shop/\") => ({\n  addToCart: async (event) => {\n    const { locals, request } = event;\n    const { prisma, user } = locals;\n    authorize(apiNames.WEBSHOP.PURCHASE, user);\n    const form = await superValidate(request, zod(addToCartSchema));\n    if (!form.valid) return fail(400, { form });\n    if (!user?.memberId && !user?.externalCode) {\n      return fail(401, { form });\n    }\n    let result;\n    try {\n      result = await addTicketToCart(prisma, form.data.ticketId, user);\n    } catch (err) {\n      let errorMsg;\n      if (err instanceof Error) errorMsg = err.message;\n      else errorMsg = String(err);\n      return message(form, {\n        message: errorMsg,\n        type: \"error\"\n      });\n    }\n    if (result.status === AddToCartStatus.AddedToInventory) {\n      throw redirect(\n        `${prefix}inventory`,\n        {\n          message: tickets_addToCart_addedToInventory(),\n          type: \"success\"\n        },\n        event\n      );\n    }\n    let successMessage;\n    switch (result.status) {\n      case AddToCartStatus.AddedToCart:\n        successMessage = tickets_addToCart_addedToCart();\n        break;\n      case AddToCartStatus.Reserved:\n        successMessage = tickets_addToCart_lotteryReservation();\n        break;\n      case AddToCartStatus.PutInQueue:\n        successMessage = tickets_addToCart_inQueue({\n          queuePosition: result.queuePosition\n        });\n        break;\n      default:\n        return message(form, {\n          message: tickets_addToCart_unknownResult(),\n          type: \"error\"\n        });\n    }\n    throw redirect(\n      `${prefix}cart`,\n      {\n        message: successMessage,\n        type: \"success\"\n      },\n      event\n    );\n  }\n});\nexport {\n  ticketPageActions as t\n};\n"],"names":[],"mappings":"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"}