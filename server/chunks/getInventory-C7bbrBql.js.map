{"version":3,"file":"getInventory-C7bbrBql.js","sources":["../../../.svelte-kit/adapter-node/chunks/getInventory.js"],"sourcesContent":["import { d as dbIdentification } from \"./types4.js\";\nimport { hn as inventory_errors_unauthorized, ho as errors_notImplemented, hp as inventory_errors_consumableNotFound } from \"./messages.js\";\nimport { ShoppableType } from \"@prisma/client\";\nimport { e as error } from \"./index.js\";\nimport { a as authorize } from \"./authorization.js\";\nimport { a as apiNames } from \"./apiNames.js\";\nconst inventoryLoadFunction = async ({\n  locals,\n  depends\n}) => {\n  const { prisma, user } = locals;\n  const { memberId, externalCode } = user ?? {};\n  if (!memberId && !externalCode) {\n    error(401, inventory_errors_unauthorized());\n  }\n  depends(\"consumables\");\n  const userId = dbIdentification(\n    memberId ? {\n      memberId\n    } : {\n      externalCode\n    }\n  );\n  const consumables = await prisma.consumable.findMany({\n    where: {\n      ...userId,\n      purchasedAt: {\n        not: null,\n        lte: /* @__PURE__ */ new Date()\n      }\n    },\n    orderBy: {\n      purchasedAt: \"desc\"\n    },\n    include: {\n      shoppable: {\n        include: {\n          ticket: {\n            include: { event: true }\n          }\n        }\n      }\n    }\n  });\n  if (!memberId && consumables) {\n    throw error(403, inventory_errors_unauthorized());\n  }\n  authorize(apiNames.WEBSHOP.PURCHASE, user);\n  const consumablesWithMoreInfo = consumables.map(\n    (consumable) => {\n      if (consumable.shoppable.type !== ShoppableType.TICKET) {\n        throw new Error(errors_notImplemented());\n      }\n      return {\n        ...consumable,\n        shoppable: {\n          ...consumable.shoppable,\n          ...consumable.shoppable.ticket,\n          event: consumable.shoppable.ticket.event\n        }\n      };\n    }\n  );\n  return {\n    consumables: consumablesWithMoreInfo\n  };\n};\nconst inventoryItemLoadFunction = async ({\n  locals,\n  depends,\n  params\n}) => {\n  const { prisma, user } = locals;\n  const { memberId, externalCode } = user ?? {};\n  if (!memberId && !externalCode) {\n    error(401, inventory_errors_unauthorized());\n  }\n  const userId = dbIdentification(\n    memberId ? {\n      memberId\n    } : {\n      externalCode\n    }\n  );\n  depends(\"consumables\");\n  const consumable = await prisma.consumable.findUnique({\n    where: {\n      ...userId,\n      id: params.id,\n      purchasedAt: {\n        not: null,\n        lte: /* @__PURE__ */ new Date()\n      }\n    },\n    include: {\n      questionResponses: {\n        include: {\n          question: true\n        }\n      },\n      shoppable: {\n        include: {\n          ticket: {\n            include: { event: true }\n          }\n        }\n      }\n    }\n  });\n  if (!consumable) {\n    error(404, inventory_errors_consumableNotFound());\n  }\n  return {\n    consumable: {\n      ...consumable,\n      shoppable: {\n        ...consumable.shoppable,\n        ...consumable.shoppable.ticket,\n        event: consumable.shoppable.ticket.event\n      }\n    }\n  };\n};\nexport {\n  inventoryItemLoadFunction as a,\n  inventoryLoadFunction as i\n};\n"],"names":[],"mappings":"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"}