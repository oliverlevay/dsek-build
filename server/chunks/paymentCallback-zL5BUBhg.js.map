{"version":3,"file":"paymentCallback-zL5BUBhg.js","sources":["../../../.svelte-kit/adapter-node/chunks/paymentCallback.js"],"sourcesContent":["import { e as ensurePaymentIntentState } from \"./stripeWebhooks.js\";\nimport { r as redirect } from \"./redirect.js\";\nimport { ht as cart_payment_success, hu as cart_payment_failed, hv as cart_payment_requiresAction, hw as cart_payment_processing, hx as cart_payment_canceled } from \"./messages.js\";\nimport { e as error } from \"./index.js\";\nconst stripeCallbackLoad = (onSuccessRedirect) => async (request) => {\n  const { url, depends } = request;\n  const payment_intent = url.searchParams.get(\"payment_intent\");\n  if (!payment_intent) {\n    error(404, \"Missing payment intent\");\n  }\n  depends(\"cart-success-page\");\n  const [intent] = await ensurePaymentIntentState(payment_intent);\n  if (intent.status === \"succeeded\") {\n    throw redirect(\n      onSuccessRedirect,\n      {\n        message: cart_payment_success(),\n        type: \"success\",\n        id: `success-${payment_intent}`\n      },\n      request\n    );\n  }\n  switch (intent.status) {\n    case \"canceled\":\n      return {\n        message: cart_payment_canceled()\n      };\n    case \"processing\":\n      return {\n        message: cart_payment_processing(),\n        refreshPeriodically: true\n      };\n    case \"requires_action\":\n      return {\n        message: cart_payment_requiresAction(),\n        refreshPeriodically: true\n      };\n    default:\n      return {\n        message: cart_payment_failed()\n      };\n  }\n};\nexport {\n  stripeCallbackLoad as s\n};\n"],"names":[],"mappings":";;;;;AAIK,MAAC,kBAAkB,GAAG,CAAC,iBAAiB,KAAK,OAAO,OAAO,KAAK;AACrE,EAAE,MAAM,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,OAAO,CAAC;AACnC,EAAE,MAAM,cAAc,GAAG,GAAG,CAAC,YAAY,CAAC,GAAG,CAAC,gBAAgB,CAAC,CAAC;AAChE,EAAE,IAAI,CAAC,cAAc,EAAE;AACvB,IAAI,KAAK,CAAC,GAAG,EAAE,wBAAwB,CAAC,CAAC;AACzC,GAAG;AACH,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAC/B,EAAE,MAAM,CAAC,MAAM,CAAC,GAAG,MAAM,wBAAwB,CAAC,cAAc,CAAC,CAAC;AAClE,EAAE,IAAI,MAAM,CAAC,MAAM,KAAK,WAAW,EAAE;AACrC,IAAI,MAAM,QAAQ;AAClB,MAAM,iBAAiB;AACvB,MAAM;AACN,QAAQ,OAAO,EAAE,oBAAoB,EAAE;AACvC,QAAQ,IAAI,EAAE,SAAS;AACvB,QAAQ,EAAE,EAAE,CAAC,QAAQ,EAAE,cAAc,CAAC,CAAC;AACvC,OAAO;AACP,MAAM,OAAO;AACb,KAAK,CAAC;AACN,GAAG;AACH,EAAE,QAAQ,MAAM,CAAC,MAAM;AACvB,IAAI,KAAK,UAAU;AACnB,MAAM,OAAO;AACb,QAAQ,OAAO,EAAE,qBAAqB,EAAE;AACxC,OAAO,CAAC;AACR,IAAI,KAAK,YAAY;AACrB,MAAM,OAAO;AACb,QAAQ,OAAO,EAAE,uBAAuB,EAAE;AAC1C,QAAQ,mBAAmB,EAAE,IAAI;AACjC,OAAO,CAAC;AACR,IAAI,KAAK,iBAAiB;AAC1B,MAAM,OAAO;AACb,QAAQ,OAAO,EAAE,2BAA2B,EAAE;AAC9C,QAAQ,mBAAmB,EAAE,IAAI;AACjC,OAAO,CAAC;AACR,IAAI;AACJ,MAAM,OAAO;AACb,QAAQ,OAAO,EAAE,mBAAmB,EAAE;AACtC,OAAO,CAAC;AACR,GAAG;AACH;;;;"}