{"version":3,"file":"getArticles-Cz_mQFbE.js","sources":["../../../.svelte-kit/adapter-node/chunks/getArticles.js"],"sourcesContent":["import { B as BASIC_ARTICLE_FILTER } from \"./articles.js\";\nimport { a as getCustomAuthorOptions } from \"./member2.js\";\nimport { e as error } from \"./index.js\";\nconst include = {\n  author: {\n    include: {\n      member: true,\n      mandate: {\n        include: {\n          position: true\n        }\n      },\n      customAuthor: true\n    }\n  },\n  comments: {\n    include: {\n      member: true\n    }\n  },\n  likers: true,\n  tags: true\n};\nconst getAllArticles = async (prisma, filters = { page: 0, pageSize: 10 }) => {\n  const pageNumber = filters.page ?? 0;\n  const pageSize = filters.pageSize ?? 10;\n  const baseFilter = BASIC_ARTICLE_FILTER();\n  const where = {\n    // search:\n    ...baseFilter,\n    ...filters.search && filters.search.length > 0 ? {\n      OR: [\n        {\n          header: {\n            contains: filters.search,\n            mode: \"insensitive\"\n          }\n        },\n        {\n          headerEn: {\n            contains: filters.search,\n            mode: \"insensitive\"\n          }\n        },\n        {\n          body: {\n            contains: filters.search,\n            mode: \"insensitive\"\n          }\n        },\n        {\n          bodyEn: {\n            contains: filters.search,\n            mode: \"insensitive\"\n          }\n        }\n      ]\n    } : {},\n    // tags\n    ...filters.tags && filters.tags.length > 0 ? {\n      tags: {\n        ...baseFilter.tags,\n        some: {\n          OR: [\n            {\n              name: {\n                in: filters.tags,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              nameEn: {\n                in: filters.tags,\n                mode: \"insensitive\"\n              }\n            },\n            ...baseFilter.tags?.some ? [baseFilter.tags.some] : []\n          ]\n        }\n      }\n    } : {}\n  };\n  const [articlesResult, countResult] = await Promise.allSettled([\n    prisma.article.findMany({\n      where,\n      orderBy: {\n        publishedAt: \"desc\"\n      },\n      skip: pageNumber * pageSize,\n      take: pageSize,\n      include\n    }),\n    prisma.article.count({ where })\n  ]);\n  if (articlesResult.status === \"rejected\") {\n    throw error(500, articlesResult.reason);\n  }\n  if (countResult.status === \"rejected\") {\n    throw error(500, countResult.reason);\n  }\n  const articles = articlesResult.value;\n  const count = countResult.value;\n  return [articles, Math.ceil(count / pageSize)];\n};\nconst getArticle = async (prisma, slug) => {\n  const response = await prisma.article.findUnique({\n    where: {\n      slug,\n      publishedAt: {\n        lte: /* @__PURE__ */ new Date(),\n        not: null\n      },\n      OR: [{ removedAt: { gt: /* @__PURE__ */ new Date() } }, { removedAt: null }]\n    },\n    include\n  });\n  return response;\n};\nconst getArticleAuthorOptions = async (prisma, memberWithMandates) => {\n  const memberId = memberWithMandates.id;\n  const customAuthorOptions = await getCustomAuthorOptions(prisma, memberId);\n  const authorOptions = [\n    {\n      id: \"0\",\n      memberId: memberWithMandates.id,\n      member: memberWithMandates,\n      mandate: null,\n      mandateId: null,\n      customAuthor: null,\n      customId: null,\n      createdAt: /* @__PURE__ */ new Date(),\n      updatedAt: /* @__PURE__ */ new Date(),\n      type: \"Member\"\n    },\n    ...memberWithMandates?.mandates.map((mandate) => {\n      return {\n        id: String(mandate.id),\n        // unique\n        memberId: memberWithMandates.id,\n        member: memberWithMandates,\n        mandateId: mandate.id,\n        mandate,\n        customAuthor: null,\n        customId: null,\n        createdAt: /* @__PURE__ */ new Date(),\n        updatedAt: /* @__PURE__ */ new Date(),\n        type: \"Mandate\"\n      };\n    }) ?? [],\n    ...customAuthorOptions?.map((customAuthor) => {\n      return {\n        id: String(customAuthor.id),\n        // unique\n        memberId: memberWithMandates.id,\n        member: memberWithMandates,\n        mandate: null,\n        mandateId: null,\n        customAuthor,\n        customId: customAuthor.id,\n        createdAt: /* @__PURE__ */ new Date(),\n        updatedAt: /* @__PURE__ */ new Date(),\n        type: \"Custom\"\n      };\n    }) ?? []\n  ];\n  return authorOptions;\n};\nexport {\n  getArticle as a,\n  getArticleAuthorOptions as b,\n  getAllArticles as g\n};\n"],"names":[],"mappings":"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"}