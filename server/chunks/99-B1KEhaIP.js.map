{"version":3,"file":"99-B1KEhaIP.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/(app)/songbook/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/99.js"],"sourcesContent":["import { c as canAccessDeletedSongs, g as getExistingCategories } from \"../../../../chunks/helpers.js\";\nconst SONGS_PER_PAGE = 10;\nconst load = async ({ locals, url }) => {\n  const { prisma, user } = locals;\n  const page = url.searchParams.get(\"page\");\n  const search = url.searchParams.get(\"search\");\n  const categories = url.searchParams.getAll(\"category\");\n  const accessPolicies = user?.policies ?? [];\n  const showDeleted = canAccessDeletedSongs(accessPolicies) && url.searchParams.get(\"show-deleted\") === \"true\";\n  let where = search ? {\n    OR: [\n      {\n        title: {\n          contains: search,\n          mode: \"insensitive\"\n        }\n      },\n      {\n        lyrics: {\n          contains: search,\n          mode: \"insensitive\"\n        }\n      },\n      {\n        category: {\n          contains: search,\n          mode: \"insensitive\"\n        }\n      },\n      {\n        melody: {\n          contains: search,\n          mode: \"insensitive\"\n        }\n      }\n    ]\n  } : {};\n  if (categories.length > 0) {\n    where = {\n      AND: [\n        where,\n        {\n          OR: categories.map((category) => ({\n            category: {\n              contains: category,\n              mode: \"insensitive\"\n            }\n          }))\n        }\n      ]\n    };\n  }\n  where = {\n    AND: [\n      where,\n      {\n        // If the user can access deleted songs, show them if the user wants to\n        // Otherwise, don't show deleted songs\n        deletedAt: showDeleted ? { not: null } : null\n      }\n    ]\n  };\n  const [songs, pageCount, existingCategories] = await Promise.all([\n    prisma.song.findMany({\n      take: SONGS_PER_PAGE,\n      skip: page ? Math.max((Number.parseInt(page) - 1) * SONGS_PER_PAGE, 0) : 0,\n      orderBy: { title: \"asc\" },\n      where\n    }),\n    prisma.song.count({ where }),\n    getExistingCategories(prisma, accessPolicies, showDeleted)\n  ]);\n  const categoryMap = {};\n  for (const category of existingCategories) {\n    const split = category.split(\" \");\n    let id;\n    if (split) {\n      if (split[0] == \"SÃ¥S\") {\n        id = split.slice(0, 2).join(\" \");\n      } else {\n        id = split ? split[0] : void 0;\n      }\n    } else {\n      id = void 0;\n    }\n    if (id) {\n      if (categoryMap[id]) {\n        categoryMap[id] = id;\n      } else {\n        categoryMap[id] = category ?? id;\n      }\n    }\n  }\n  return {\n    songs,\n    pageCount: Math.max(Math.ceil(pageCount / SONGS_PER_PAGE), 1),\n    categories,\n    categoryMap,\n    params: url.searchParams.toString()\n  };\n};\nexport {\n  load\n};\n","import * as server from '../entries/pages/(app)/songbook/_page.server.ts.js';\n\nexport const index = 99;\nlet component_cache;\nexport const component = async () => component_cache ??= (await import('../entries/pages/(app)/songbook/_page.svelte.js')).default;\nexport { server };\nexport const server_id = \"src/routes/(app)/songbook/+page.server.ts\";\nexport const imports = [\"_app/immutable/nodes/99.B5j7xDsl.js\",\"_app/immutable/chunks/scheduler.DK5noefF.js\",\"_app/immutable/chunks/index.OECaLbXR.js\",\"_app/immutable/chunks/each.Dbd03sI1.js\",\"_app/immutable/chunks/PageHeader.C1QSjqnO.js\",\"_app/immutable/chunks/stores.BdoTh84D.js\",\"_app/immutable/chunks/123.BVaw0gZK.js\",\"_app/immutable/chunks/index.BanBdRDU.js\",\"_app/immutable/chunks/SetPageTitle.Cf9LBAU4.js\",\"_app/immutable/chunks/pageTitle.DQXADn3y.js\",\"_app/immutable/chunks/bundle-mjs.BkWO730n.js\",\"_app/immutable/chunks/Pagination.C3TH-bth.js\",\"_app/immutable/chunks/SearchBar.D5otZFyl.js\",\"_app/immutable/chunks/redirect.D99U8wwi.js\",\"_app/immutable/chunks/i18n.Cv4-1ZiX.js\",\"_app/immutable/chunks/runtime.DTG1FAeQ.js\",\"_app/immutable/chunks/index.DQfRr7yB.js\",\"_app/immutable/chunks/apiNames.G3FqMHey.js\",\"_app/immutable/chunks/authorization.BfNSR1Nc.js\",\"_app/immutable/chunks/SongElement.m9wBhzD4.js\",\"_app/immutable/chunks/messages.DZzIl59o.js\"];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":"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"}