{"version":3,"file":"getEvents-gKry0X74.js","sources":["../../../.svelte-kit/adapter-node/chunks/getEvents.js"],"sourcesContent":["import { B as BASIC_EVENT_FILTER } from \"./events.js\";\nimport { e8 as events_errors_invalidPage } from \"./messages.js\";\nconst include = {\n  author: true,\n  comments: {\n    include: {\n      member: true\n    }\n  },\n  going: true,\n  interested: true,\n  tags: true\n};\nconst getAllEvents = async (prisma, filters = { page: 0, pageSize: 10 }, baseFilter = true) => {\n  const pageNumber = filters.page ?? 0;\n  const pageSize = filters.pageSize ?? 10;\n  const base = BASIC_EVENT_FILTER();\n  const where = {\n    AND: [\n      baseFilter ? base : {},\n      {\n        endDatetime: filters.pastEvents ? {\n          lte: /* @__PURE__ */ new Date()\n        } : {\n          gte: /* @__PURE__ */ new Date()\n        },\n        // search:\n        ...filters.search && filters.search.length > 0 ? {\n          OR: [\n            {\n              title: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              titleEn: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              shortDescription: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              shortDescriptionEn: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              description: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            },\n            {\n              descriptionEn: {\n                contains: filters.search,\n                mode: \"insensitive\"\n              }\n            }\n          ]\n        } : {},\n        // tags\n        ...filters.tags && filters.tags.length > 0 ? {\n          tags: {\n            some: {\n              OR: [\n                {\n                  name: {\n                    in: filters.tags,\n                    mode: \"insensitive\"\n                  }\n                },\n                {\n                  nameEn: {\n                    in: filters.tags,\n                    mode: \"insensitive\"\n                  }\n                }\n              ]\n            }\n          }\n        } : {}\n      }\n    ]\n  };\n  const [events, count] = await prisma.$transaction(async (tx) => {\n    const events2 = tx.event.findMany({\n      where,\n      orderBy: {\n        startDatetime: filters.pastEvents ? \"desc\" : \"asc\"\n      },\n      skip: pageNumber * pageSize,\n      take: pageSize,\n      include\n    });\n    const count2 = tx.event.count({ where });\n    return [await events2, await count2];\n  });\n  return [events, Math.ceil(count / pageSize)];\n};\nconst getEvent = async (prisma, slug) => {\n  const response = await prisma.event.findUnique({\n    where: {\n      slug\n    },\n    include\n  });\n  return response;\n};\nconst getAndValidatePage = (url) => {\n  const page = url.searchParams.get(\"page\");\n  if (page && Number.isNaN(Number.parseInt(page))) {\n    throw new Error(events_errors_invalidPage());\n  }\n  return page ? Math.max(Number.parseInt(page) - 1, 0) : void 0;\n};\nexport {\n  getAndValidatePage as a,\n  getEvent as b,\n  getAllEvents as g\n};\n"],"names":[],"mappings":"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"}